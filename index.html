<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Artificial Intelligence and Data Science</title>
<link href="https://fonts.googleapis.com/css2?family=Tektur:wght@400;500;600&display=swap" rel="stylesheet">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="favicon.png">
<link rel="shortcut icon" href="favicon.png">
<link rel="apple-touch-icon" href="favicon.png">
  
<style>
:root {
  --bg-dark:#0b1220;
  --bg-card:#2a3445;
  --green:#00c853;
  --text:#e5e7eb;
  --neon-blue:#22d3ee;
  --neon-green:#22c55e;
  --neon-pink:#f472b6;
}
body {
  margin:0;
  font-family:"Tektur",sans-serif;
  color:var(--text);
  background:
    radial-gradient(circle at 20% 20%, #1f2937 0%, transparent 40%),
    radial-gradient(circle at 80% 30%, #0ea5e9 0%, transparent 35%),
    radial-gradient(circle at 50% 80%, #22c55e 0%, transparent 40%),
    linear-gradient(120deg,#020617,#0b1220,#111827);
  background-attachment: fixed;
}
.hidden{display:none}
.center{
  height:100vh;
  display:none;          /* üî• ADD */
  justify-content:center;
  align-items:center;
  position:fixed;
  top:0;
  left:0;
  width:100%;
  background:inherit;
}
.box{
  background: linear-gradient(180deg,#020617,#020617cc);
  padding:36px;
  border-radius:22px;
  width:100%;
  max-width:420px;
  box-sizing:border-box;

  border:1px solid rgba(255,255,255,.08);
  backdrop-filter: blur(14px);

  box-shadow:
    0 30px 60px rgba(0,0,0,.55),
    inset 0 0 0 1px rgba(255,255,255,.04);
}
/* Admin note textarea styling */
textarea{
  width:100%;
  background:#020617;
  color:#e2e8f0;
  border:none;
  border-radius:10px;
  padding:12px;
  font-size:14px;
  outline:none;
  resize:vertical;
  box-sizing:border-box;
}

textarea::placeholder{
  color:#64748b;
}

input,button{
  width:80%;padding:12px;margin-bottom:12px;
  border:none;border-radius:8px
}
button{
  background:linear-gradient(135deg,#22c55e,#06b6d4);
  color:white;
  border:none;
  padding:12px 18px;
  border-radius:12px;
  font-weight:600;
  letter-spacing:.4px;
  cursor:pointer;
  position:relative;
  overflow:hidden;
}
button::after{
  content:"";
  position:absolute;
  inset:0;
  background:linear-gradient(120deg,transparent,rgba(255,255,255,.35),transparent);
  transform:translateX(-100%);
  transition:.5s;
}
button:hover::after{
  transform:translateX(100%);
}


nav{
  background:rgba(0,0,0,.45);
  backdrop-filter: blur(16px);
  border-bottom:1px solid rgba(255,255,255,.08);
  padding:15px 30px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.logo{font-size:22px;font-weight:bold;color:white}
nav ul{list-style:none;display:flex;gap:25px;margin:0;padding:0}
nav li{cursor:pointer;color:white}

.container{max-width:1100px;margin:auto;padding:40px 20px;text-align:center}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:25px}
.card{
  background: rgba(42,52,69,0.55);
  backdrop-filter: blur(12px);
  border:1px solid rgba(255,255,255,0.08);
  padding:30px;
  border-radius:20px;
  position:relative;
  overflow:hidden;
}
.card::before{
  content:"";
  position:absolute;
  inset:0;
  background:linear-gradient(120deg,transparent,rgba(56,189,248,.25),transparent);
  opacity:0;
  transition:.4s;
}
.card:hover::before{
  opacity:1;
}

.card h2{color:#38bdf8}

/* ===== ADD START: new UI only ===== */
.option-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:25px;
  margin-top:30px;
}
.option-card{
  background:var(--bg-card);
  padding:25px;
  border-radius:18px;
  cursor:pointer;
}
.option-card h3{color:#38bdf8}
/* ===== ADD END ===== */

@keyframes fadeIn {
  from { opacity:0; transform:scale(0.98); }
  to   { opacity:1; transform:scale(1); }
}

#app .container{
  animation: fadeIn 0.35s ease-in-out;
}


.card,
.option-card{
  transition: transform 0.25s ease, box-shadow 0.25s ease;
}

.card:hover,
.option-card:hover{
  transform: translateY(-6px);
  box-shadow: 0 10px 25px rgba(144, 13, 13, 0.3);
}

.fade{
  animation: fadeIn 0.35s ease-in-out;
}

/* ===== Back button animation ===== */
.back-btn,
button[onclick^="goBack"],
button[onclick^="back"]{
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.back-btn:hover,
button[onclick^="goBack"]:hover,
button[onclick^="back"]:hover{
  transform: translateX(-4px);
  box-shadow: 0 6px 15px rgba(0,0,0,0.25);
}

.back-btn:active,
button[onclick^="goBack"]:active,
button[onclick^="back"]:active{
  transform: scale(0.95);
}

/* Login & Register buttons animation */
#login button,
#register button{
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

#login button:hover,
#register button:hover{
  transform: translateY(-3px);
  box-shadow: 0 6px 15px rgba(0,0,0,0.3);
}

#login button:active,
#register button:active{
  transform: scale(0.95);
}

/* Login/Register text link animation */
#login p,
#register p{
  transition: color 0.2s ease, transform 0.2s ease;
}

#login p:hover,
#register p:hover{
  transform: translateX(4px);
  color:#7dd3fc;
}

.card:hover,
.option-card:hover{
  transform: translateY(-6px);
  box-shadow: 0 10px 25px rgba(0,0,0,0.3);
}

#login input:focus,
#register input:focus{
  outline:none;
  border:2px solid #38bdf8;
  background:#020617;
  box-shadow: 0 0 0 3px rgba(56,189,248,0.25);
  transform: scale(1.03);
}

.site-footer{
  margin-top:auto;
  flex-shrink: 0;
  padding: 15px 0;
  font-size:15px;
  color:#9ca3af;
  text-align:center;
  background:var(--bg-dark);
}

/* ===== FONT POLISH ===== */
h1, h2, h3, .logo {
  font-weight:600;
  letter-spacing:0.5px;
}
button {
  font-family: "Tektur", sans-serif;
  font-weight:500;
}
input {
  font-family: "Tektur", sans-serif;
}

/* ===== NAVBAR ANIMATION ===== */
#app:not(.hidden) nav{
  animation: navSlide 0.6s ease-out;
}


@keyframes navSlide{
  from{ transform: translateY(-100%); opacity:0; }
  to{ transform: translateY(0); opacity:1; }
}

.logo{
  animation: logoPop 0.6s ease-out 0.3s both;
}

@keyframes logoPop{
  from{ transform: scale(0.8); opacity:0; }
  to{ transform: scale(1); opacity:1; }
}

nav li{
  position:relative;
  transition: transform 0.25s ease, opacity 0.25s ease;
}

nav li:hover{
  transform: translateY(-3px);
  opacity:0.9;
}

nav li::after{
  content:"";
  position:absolute;
  left:0;
  bottom:-6px;
  width:0;
  height:2px;
  background:white;
  transition: width 0.3s ease;
}

nav li:hover::after{
  width:100%;
}

#app{
  min-height:100vh;
  display:flex;
  flex-direction:column;
}

#dashboard,
#specialProgram,
#specialCourseView,
#profile,
#supportPage,
#supportFormPage,
#contactInfoPage,
#admin{
  flex:1 0 auto;
  width: 100%;
  display: block;
}

#login input,
#register input{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:1px solid #1f2937;
  background:#020617;
  color:#e5e7eb;
  transition:.25s;
}

#login input:focus,
#register input:focus{
  border-color:#22d3ee;
  box-shadow:0 0 0 4px rgba(34,211,238,.15);
  transform:translateY(-1px);
}
.hero{
  text-align:left;
  padding:30px;
  border-radius:20px;
  margin-bottom:30px;
  background:
    linear-gradient(135deg,rgba(56,189,248,.15),rgba(34,197,94,.12));
  border:1px solid rgba(255,255,255,.08);
}
.hero h1{font-size:28px;margin:0 0 8px}
.hero p{opacity:.8}

.avatar{
  width:90px;
  height:90px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:36px;
  margin:0 auto 14px;
  background:linear-gradient(135deg,#22d3ee,#22c55e);
  color:#022c22;
}
.meta{margin-top:18px;display:grid;gap:12px}
.meta label{font-size:12px;opacity:.6}

#admin .card{
  border:1px solid rgba(239,68,68,.25);
  box-shadow:0 0 30px rgba(239,68,68,.08);
}
#admin button{
  background:linear-gradient(135deg,#ef4444,#dc2626);
}
#admin input{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:1px solid #1f2937;
  background:#020617;
  color:#e5e7eb;
  font-family:"Tektur",sans-serif;
  z-index:5;
  position:relative;
}
.login-brand{
  display:grid;
  grid-template-columns: 80px 1fr 80px;
  align-items:center;
  margin-bottom:22px;
}

.brand-logo{
  width:68px;
  height:68px;
  object-fit:contain;

  filter:
    drop-shadow(0 0 12px rgb(159, 149, 4))
    drop-shadow(0 0 28px rgb(7, 112, 129));
}

.brand-title{
  font-size:25px;
  letter-spacing:1px;
  font-weight:600;
  color:#22d3ee;
  text-shadow:
    0 0 12px rgba(34,211,238,.8),
    0 0 26px rgba(34,211,238,.35);
}

.brand-sub{
  font-size:15px;
  font-weight:500;
  opacity:.95;
  letter-spacing:1px;
}
.brand-text{
  text-align:center;
  line-height:1.3;
  justify-self:center;
}
.brand-logo-right{
  width:98px;
  height:98px;

  filter:
    drop-shadow(0 0 16px rgb(30, 255, 0))
    drop-shadow(0 0 34px rgb(26, 103, 31));
}
@media(max-width:420px){
  .brand-logo-right{
    width:60px;
    height:60px;
  }
}

@media(max-width:420px){
  .login-brand{
    grid-template-columns: 50px 1fr 50px;
  }
}
.setpass-card {
  width: 420px;
  max-width: 90%;
  padding: 32px;
  border-radius: 20px;
  background: rgba(15, 23, 42, 0.85);
  backdrop-filter: blur(12px);
  box-shadow: 0 20px 50px rgba(0,0,0,0.35);
  text-align: center;
}
.setpass-card h2 {
  color: #e5e7eb;
  margin-bottom: 6px;
  font-size: 22px;
}
.setpass-sub {
  font-size: 13px;
  color: #94a3b8;
  margin-bottom: 22px;
}
.setpass-card input {
  width: 100%;
  padding: 14px 16px;
  margin-bottom: 14px;
  border-radius: 12px;
  border: none;
  outline: none;
  font-size: 14px;
}
.setpass-card button {
  width: 100%;
  padding: 14px;
  border-radius: 14px;
  border: none;
  font-size: 15px;
  font-weight: 600;
  color: white;
  cursor: pointer;
  background: linear-gradient(135deg, #22c55e, #06b6d4);
  transition: 
    transform 0.15s ease,
    box-shadow 0.15s ease;
}
.setpass-card button:hover {
  transform: translateY(-1px);
  box-shadow: 0 8px 20px rgba(34,197,94,0.35);
}
.setpass-card button:active {
  transform: scale(0.97);
}

/* ===== REGISTER PORTAL CUSTOM DESIGN ===== */
.register-box{
  border: 1px solid rgba(34,211,238,0.35);
  background:
    linear-gradient(160deg, #020617, #020617cc),
    radial-gradient(circle at top right, rgba(34,211,238,.18), transparent 40%);
}
.register-box h2{
  color:#22d3ee;
  text-shadow:0 0 12px rgba(34,211,238,.6);
}
.register-box button{
  background: linear-gradient(135deg,#22d3ee,#06b6d4);
}
.register-box{
  animation: registerPop 0.4s ease;
}
@keyframes registerPop{
  from{
    opacity:0;
    transform: scale(0.96);
  }
  to{
    opacity:1;
    transform: scale(1);
  }
}
/* ===== LOGIN PORTAL CUSTOM DESIGN ===== */
.login-box{
  border: 1px solid rgba(99,102,241,0.35);
  background:
    linear-gradient(160deg, #020617, #020617cc),
    radial-gradient(circle at top left, rgba(99,102,241,.18), transparent 40%);
}
.login-box h2{
  color:#6366f1;
  text-shadow:0 0 12px rgba(99,102,241,.6);
}
.login-box button{
  background: linear-gradient(135deg,#6366f1,#4f46e5);
}
.login-box{
  animation: loginPop 0.4s ease;
}
@keyframes loginPop{
  from{
    opacity:0;
    transform: scale(0.96);
  }
  to{
    opacity:1;
    transform: scale(1);
  }
}
/* ===== PROFILE MOBILE TWEAK ===== */
@media(max-width:600px){
  #profile .grid{
    gap:18px;
  }
  #profile .card{
    padding:22px;
  }
}
/* ===== PROFILE SECTION TITLE STYLE ===== */
#profile h3{
  font-size:18px;
  margin-bottom:12px;
  padding-bottom:6px;
  color:#22d3ee;
  border-bottom:2px solid rgba(34,211,238,0.35);
  letter-spacing:0.4px;
}
/* ===== PROFILE CARD ACTIVE HOVER ===== */
#profile .card{
  transition:
    transform 0.25s ease,
    box-shadow 0.25s ease,
    border-color 0.25s ease;
}

#profile .card:hover{
  transform: translateY(-4px);
  border-color:#22d3ee;
  box-shadow:
    0 12px 30px rgba(34,211,238,0.25);
}
button:disabled{
  opacity:0.7;
  cursor:not-allowed;
}
/* ===== Notice Highlight Text ===== */
.notice-highlight{
  margin:10px 0 16px;
  padding:10px 14px;
  font-weight:600;
  color:#eafff6;
  background:linear-gradient(
    90deg,
    rgba(34,197,94,0.25),
    rgba(16,185,129,0.25)
  );
  border-left:4px solid #22c55e;
  border-radius:8px;
  box-shadow:inset 0 0 0 1px rgba(34,197,94,0.25);
}
/* ===== ROUTINE MODAL FIX ===== */
.modal{
  position:fixed;
  top:0;
  left:0;
  width:100vw;
  height:100vh;
  background:rgba(0,0,0,0.65);
  display:flex;
  align-items:center;
  justify-content:center;

  z-index:9999;
}
.modal.hidden{
  display:none;
}
.modal-box{
  background:#0f172a;
  padding:24px;
  border-radius:16px;
  width:92vw;
  height:88vh;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}
.modal-box img{
  width:100%;
  object-fit:contain;
  border-radius:10px;
}
.modal-box button{
  margin-top:16px;
}
/* ===== MODAL SCROLL FIX ===== */
.modal-content{
  flex:1;
  overflow-y:auto;
  margin:12px 0;
}

.modal-box button{
  position:sticky;
  bottom:0;
  padding:14px;
}
/* ===== FINAL SUPPORT FORM (BEST VERSION) ===== */

.support-form-card{
  max-width: 720px;
  margin: 40px auto;
  padding: 32px;


  background: linear-gradient(
    180deg,
    rgba(15,23,42,0.85),
    rgba(2,6,23,0.9)
  );

  border: 1px solid rgba(148,163,184,0.15);
  border-radius: 18px;

  box-shadow:
    0 30px 60px rgba(0,0,0,0.45);

  animation: supportCardIn 0.6s ease-out;
}
#supportSubject{
  width: 85%;
  margin: 0 auto 14px auto;
  display: block;
}

/* Card entry animation */
@keyframes supportCardIn{
  from{
    opacity: 0;
    transform: translateY(18px);
  }
  to{
    opacity: 1;
    transform: translateY(0);
  }
}

/* Inputs */
.support-form-card input,
.support-form-card textarea{
  width: 100%;
  padding: 15px 18px;

  background: rgba(2,6,23,0.9);
  border: 1px solid rgba(148,163,184,0.25);
  border-radius: 12px;

  color: #e5e7eb;
  font-size: 15px;

  transition:
    border-color 0.25s ease,
    box-shadow 0.25s ease,
    transform 0.2s ease;
}

.support-form-card textarea{
  min-height: 160px;
  resize: vertical;
}

/* Input focus animation */
.support-form-card input:focus,
.support-form-card textarea:focus{
  outline: none;
  border-color: #38bdf8;
  box-shadow: 0 0 0 4px rgba(56,189,248,0.18);
  transform: translateY(-1px);
}

/* Button */
.support-form-card button{
  margin-top: 10px;
  padding: 15px;
  width: 100%;

  background: linear-gradient(
    135deg,
    #22c55e,
    #06b6d4
  );

  border: none;
  border-radius: 14px;

  color: white;
  font-size: 15px;
  font-weight: 600;
  letter-spacing: 0.4px;

  cursor: pointer;

  transition:
    transform 0.2s ease,
    box-shadow 0.25s ease,
    filter 0.25s ease;
}

/* Button hover animation */
.support-form-card button:hover{
  transform: translateY(-2px);
  box-shadow: 0 12px 28px rgba(34,197,94,0.35);
  filter: brightness(1.05);
}

/* Button press */
.support-form-card button:active{
  transform: scale(0.97);
}
#supportFormTitle{
  margin-bottom: 18px;
  color: #e5e7eb;
  animation: titleFade 0.5s ease-out;
}

@keyframes titleFade{
  from{
    opacity: 0;
    transform: translateY(-6px);
  }
  to{
    opacity: 1;
    transform: translateY(0);
  }
}
/* ===== CONTACT LIST ===== */

.contact-list{
  display: flex;
  flex-direction: column;
  gap: 14px;
}

.contact-item{
  display: flex;
  flex-direction: column;
  gap: 4px;

  padding: 16px 18px;
  border-radius: 14px;

  background: rgba(2,6,23,0.85);
  border: 1px solid rgba(148,163,184,0.25);

  color: #e5e7eb;
  text-decoration: none;
  font-size: 15px;

  transition: transform 0.2s ease, box-shadow 0.25s ease;
}

.contact-item span{
  font-size: 13px;
  opacity: 0.75;
}

.contact-item:hover{
  transform: translateY(-2px);
  box-shadow: 0 10px 25px rgba(0,0,0,0.35);
}
/* ===== MY SUPPORT REQUESTS UI ===== */

.support-history-card{
  animation: fadeUp 0.5s ease;
}

.support-list{
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-top: 14px;
}

.support-item{
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 14px 16px;
  border-radius: 14px;
  background: linear-gradient(
    180deg,
    rgba(15,23,42,0.9),
    rgba(2,6,23,0.95)
  );
  border: 1px solid rgba(148,163,184,0.15);
  box-shadow: 0 8px 20px rgba(0,0,0,0.35);
  animation: fadeUp 0.4s ease;
}

.support-info{
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.support-title{
  font-size: 14px;
  font-weight: 600;
  color: #e5e7eb;
}

.support-meta{
  font-size: 12px;
  opacity: 0.7;
}

.support-status{
  padding: 6px 12px;
  border-radius: 999px;
  font-size: 12px;
  font-weight: 600;
}

.support-status.pending{
  background: rgba(234,179,8,0.15);
  color: #facc15;
}
.support-status.resolved{
  background: rgba(34,197,94,0.15);
  color: #22c55e;
}
.support-status.rejected{
  background: rgba(239,68,68,0.15);
  color: #ef4444;
  border: 1px solid rgba(239,68,68,0.35);
}


.support-loading,
.support-empty{
  text-align: center;
  font-size: 14px;
  opacity: 0.6;
  padding: 20px 0;
}

@keyframes fadeUp{
  from{
    opacity: 0;
    transform: translateY(10px);
  }
  to{
    opacity: 1;
    transform: translateY(0);
  }
}
/* ===== ADMIN SUPPORT STATUS DROPDOWN FIX ===== */
#admin select{
  width: 160px;
  padding: 10px 12px;
  margin-top: 10px;
  margin-right: 10px;

  background: #020617;
  color: #e5e7eb;

  border: 1px solid rgba(148,163,184,0.35);
  border-radius: 10px;

  font-family: "Tektur", sans-serif;
  font-size: 14px;

  outline: none;
}

#admin select option{
  background: #020617;
  color: #e5e7eb;
}
/* ===== FIX: allow select click inside admin cards ===== */
#admin .card::before{
  pointer-events: none;
}
#admin select{
  position: relative;
  z-index: 5;
}
/* ===== ADMIN MENU LAYOUT ===== */
.admin-wrap{
  display:flex;
  gap:25px;
  align-items:flex-start;
}
.admin-menu{
  width:200px;
  background:#020617;
  border-radius:12px;
  padding:15px;
}
.admin-menu div{
  padding:12px;
  margin-bottom:10px;
  cursor:pointer;
  border-radius:8px;
  background:#111827;
}
.admin-menu div:hover{
  background:#22d3ee;
  color:black;
}
/* Slide animation */
.admin-view{
  flex:1;
  min-height:600px;
  overflow:visible;
}.admin-section{
  display:none;
  width:100%;
}
.admin-section.active{
  display:block;
  overflow:visible;
}
/* ===== ADMIN LAYOUT POLISH ===== */

.admin-menu{
  min-width:200px;
}
.admin-view .card{
  width:100%;
}
#sec-find input{
  margin-bottom:15px;
}
#foundUser{
  margin-top:20px;
}
#foundUser .card{
  margin-top:20px;
}
/* ===== FIND USER RESULT FIX ===== */

#foundUser{
  width:100%;
}
#foundUser .card{
  width:100%;
  box-sizing:border-box;
  margin-top:20px;
}
.admin-view{
  overflow:visible;
}


</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="center">
  <div class="box login-box">
    <div class="login-brand">

  <img src="favicon.png" class="brand-logo">
  <div class="brand-text">
    <div class="brand-title">AI & DATA SCIENCE</div>
    <div class="brand-sub">ADS 250</div>
  </div>
  <img src="gublogo.png" class="brand-logo brand-logo-right">
</div>
    <h2>üîê Login Portal</h2>
    <input id="loginId" placeholder="Student ID">
    <input id="loginOtp" placeholder="Passcode" type="password">
    <button id="loginBtn" onclick="doLogin()">Access Portal</button>
    <p onclick="showRegister()" style="cursor:pointer;color:#38bdf8">Register</p>
    <div class="error" id="loginError"></div>
  </div>
</div>

<!-- REGISTER -->
<div id="register" class="center">
  <div class="box register-box">
    <h2>üìù Registration Portal</h2>
    <input id="regName" placeholder="Full Name">
    <input id="regId" type="number" placeholder="Student ID">
    <input id="regEmail" type="email" placeholder="Email">
      <!-- BATCH NUMBER -->
  <div style="display:flex;gap:10px">
    <input value="ADS" disabled style="width:30%;opacity:0.7">
    <input id="regBatchNum" type="number" placeholder="Batch (e.g. 250)" style="width:70%">
  </div>
    <button onclick="doRegister()">Register</button>
    <p onclick="showLogin()" style="cursor:pointer;color:#38bdf8">Back to Login</p>
    <div id="regResult"></div>
  </div>
</div>

<!-- SET PASSWORD -->
<div id="setPassword" class="center hidden">
  <div class="setpass-card">
    <h2>üîê Set New Password</h2>
    <p class="setpass-sub">
      This is your first login. Please choose a new password.
    </p>
    <form onsubmit="setNewPassword(event)">
      <input
        id="newPass"
        type="password"
        placeholder="New password"
        required
      >
      <input
        id="confirmPass"
        type="password"
        placeholder="Confirm password"
        required
      >
      <button type="submit">
        Save & Continue
      </button>
    </form>
  </div>
</div>


<!-- APP -->
<div id="app" class="hidden">
  <nav style="display:none">
  <div class="logo">Artificial Intelligence and Data Science</div>
  <ul>
    <li onclick="showDashboard()">Home</li>
    <li onclick="showSpecialProgram()">Special Program</li>
    <li onclick="showProfile()">Profile</li>
    <li id="supportNav" onclick="showSupport()">Support</li>
    <li id="adminNav" onclick="showAdmin()" style="display:none">Admin</li>
  </ul>
</nav>

<!-- DASHBOARD -->
<div id="dashboard" class="container fade hidden">
  <div id="semesterList">
    <div class="hero">
  <h1 id="welcomeText">Welcome back üëã</h1>
    <p>Your gateway to academic resources and course management.</p>
</div>
    <div class="grid">
      <div class="card">
        <h2>Spring Semester 2026</h2>
        <button onclick="openSemester()">View Details</button>
      </div>
    </div>
  </div>

  <div id="semester" class="hidden fade">
    <button onclick="goBack()" style="
      background:#7c3aed;color:white;border:none;
      padding:10px 20px;border-radius:10px;cursor:pointer;margin-bottom:25px;">
      ‚Üê Back to Semesters
    </button>

    <h2 style="color:#22d3ee;margin-bottom:30px">Spring Semester 2026</h2>

    <div class="grid">
      <div class="card"><h2>Introduction to Data Science</h2>
        <p class="course-code"> Course Code: <b>ADS-201</b></p>
        <button>View Details</button></div>
      <div class="card"><h2>Physics</h2>
        <p class="course-code"> Course Code: <b>PHY-101</b></p>
        <button>View Details</button></div>
      <div class="card"><h2>Linear Algebra</h2>
        <p class="course-code"> Course Code: <b>MAT-105</b></p>
        <button>View Details</button></div>
      <div class="card"><h2>Professional English</h2>
        <p class="course-code"> Course Code: <b>ESP-103</b></p>
        <button>View Details</button></div>
      <div class="card"><h2>Physics Lab</h2>
        <p class="course-code"> Course Code: <b>PHY-102</b></p>
        <button>View Details</button></div>
      <div class="card"><h2>Professional Life Skill Development</h2>
        <p class="course-code"> Course Code: <b>PSD-400</b></p>
        <button>View Details</button></div>
    </div>
  </div>

  <!-- ===== ADD START: Course level ===== -->
  <div id="courseView" class="hidden fade">
    <button onclick="backToSemester()" style="background:#7c3aed;color:white;border:none;padding:10px 20px;border-radius:10px;cursor:pointer;margin-bottom:25px;">
      ‚Üê Back to Courses
    </button>
    <h2 id="courseTitle"></h2>
    <div class="option-grid">
      <div class="option-card" onclick="openExam('Mid-Term')">
        <h3>Mid-Term</h3>
        <button>View Details</button></div>
      <div class="option-card" onclick="openExam('Final')"><h3>Final</h3>
        <button>View Details</button></div>
    </div>
  </div>

  <!-- ===== ADD START: Exam level ===== -->
  <div id="examView" class="hidden fade">
    <button onclick="backToCourse()" style="background:#7c3aed;color:white;border:none;padding:10px 20px;border-radius:10px;cursor:pointer;margin-bottom:25px;">
      ‚Üê Back
    </button>
    <h2 id="examTitle"></h2>
    <div class="option-grid">
      <div class="option-card" onclick="openDrive('materials')"><h3>üìÅ Class Materials</h3></div>
      <div class="option-card" onclick="openDrive('resources')"><h3>üìö Resources</h3></div>
    </div>
  </div>
</div>

<!-- SPECIAL PROGRAM -->
<div id="specialProgram" class="container hidden fade">
  <button onclick="backToDashboard()" style="
    background:#7c3aed;
    color:white;
    border:none;
    padding:10px 20px;
    border-radius:10px;
    cursor:pointer;
    margin-bottom:25px;">
    ‚Üê Back
  </button>
  <h2 style="color:#22d3ee;margin-bottom:30px">
    Special Program
  </h2>
  <div class="grid">
    <div class="card" onclick="openSpecialCourse('Computer Programming')">
      <h2>Computer Programming</h2>
      <button>View Details</button>
    </div>
    <div class="card" onclick="openSpecialCourse('Discrete Mathematics')">
      <h2>Discrete Mathematics</h2>
      <button>View Details</button>
    </div>
  </div>
</div>
<!-- SPECIAL PROGRAM COURSE VIEW -->
<div id="specialCourseView" class="container hidden fade">
  <button onclick="backToSpecialProgram()" style="
    background:#7c3aed;
    color:white;
    border:none;
    padding:10px 20px;
    border-radius:10px;
    cursor:pointer;
    margin-bottom:25px;">
    ‚Üê Back
  </button>
  <h2 id="specialCourseTitle" style="color:#22d3ee;margin-bottom:30px">
    Computer Programming
  </h2>
  <div class="option-grid" id="specialOptions">
  </div>
</div>

<!-- PROFILE -->
<div id="profile" class="container hidden fade">
  <div class="card">
    <div id="profileData"></div>
  </div>
</div>

<!-- SUPPORT PAGE -->
<div id="supportPage" class="container hidden fade">

  <button onclick="backToDashboard()" style="
    background:#7c3aed;
    color:white;
    border:none;
    padding:10px 20px;
    border-radius:10px;
    cursor:pointer;
    margin-bottom:25px;">
    ‚Üê Back
  </button>

  <h2 style="color:#22d3ee;margin-bottom:30px">
    Support Center
  </h2>

  <div class="option-grid">

    <div class="option-card" onclick="openSupportForm('materials')">
      <h3>üìö Materials & Notes</h3>
      <p>Request course materials or contribute your own notes and uploads</p>
    </div>

    <div class="option-card" onclick="openSupportForm('feedback')">
      <h3>üìù Feedback</h3>
      <p>Share your suggestions or feedback with us</p>
    </div>

    <div class="option-card" onclick="openSupportForm('bug')">
      <h3>üêû Report a Problem</h3>
      <p>Report bugs or issues you encounter</p>
    </div>

    <div class="option-card" onclick="showContactInfo()">
      <h3>üìû Contact Us</h3>
      <p>Get direct support or ask a question</p>
    </div>

  </div>
</div>
<!-- SUPPORT FORM PAGE -->
<div id="supportFormPage" class="container hidden fade">

  <button onclick="showSupport()" style="
    background:#7c3aed;
    color:white;
    border:none;
    padding:10px 20px;
    border-radius:10px;
    cursor:pointer;
    margin-bottom:25px;">
    ‚Üê Back
  </button>

  <h2 id="supportFormTitle" style="color:#22d3ee;margin-bottom:20px">
    Support
  </h2>
  <input type="hidden" id="supportType">
  <div class="support-form-card">
    <input id="supportSubject" placeholder="Subject">
    <textarea
      id="supportMessage"
      placeholder="Write your message..."
    ></textarea>
    <button onclick="submitSupport()">Submit</button>
  </div>
</div>
<!-- CONTACT INFO PAGE -->
<div id="contactInfoPage" class="container hidden fade">

  <button onclick="showSupport()" style="
    background:#7c3aed;
    color:white;
    border:none;
    padding:10px 20px;
    border-radius:10px;
    cursor:pointer;
    margin-bottom:25px;">
    ‚Üê Back
  </button>

  <h2 style="color:#22d3ee;margin-bottom:30px">
    Contact Us
  </h2>

  <div class="support-form-card contact-list">
    <!-- WhatsApp -->
    <a class="contact-item" href="https://wa.me/8801601401311" target="_blank">
      üü¢ WhatsApp
      <span>Chat with us on WhatsApp</span>
    </a>
    <!-- Telegram -->
    <a class="contact-item" href="https://t.me/sifatahammed" target="_blank">
      üîµ Telegram
      <span>Message us on Telegram</span>
    </a>
    <!-- Facebook -->
    <a class="contact-item" href="https://facebook.com/useromcv" target="_blank">
      üî∑ Facebook - 1
      <span>Admin Profile</span>
    </a>
    <!-- Facebook -->
    <a class="contact-item" href="https://facebook.com/jahidhossan480" target="_blank">
      üî∑ Facebook - 2
      <span>Admin Profile</span>
    </a>
    <!-- Email -->
    <a class="contact-item" href="mailto:ads.githubportal@gmail.com">
      üìß Email
      <span>ads.githubportal@gmail.com</span>
    </a>
  </div>
</div>


<!-- ADMIN -->
<div id="admin" class="container hidden fade">

  <div class="admin-wrap">

    <!-- LEFT MENU -->
    <div class="admin-menu">

      <div onclick="switchAdmin('find')">
        üîç Find User
      </div>

      <div onclick="switchAdmin('pending'); loadPendingUsers();">
        ‚è≥ Pending (<span id="pendingCount">0</span>)
      </div>

      <div onclick="switchAdmin('support'); loadAdminSupportInbox();">
        üõ† Support (<span id="supportCount">0</span>)
      </div>

    </div>

    <!-- RIGHT CONTENT -->
    <div class="admin-view">

  <!-- FIND USER -->
      <div id="sec-find" class="admin-section active">
        <div class="card">

          <h2>Find User</h2>

          <input
            id="searchStudentId"
            placeholder="Enter Student ID"
            style="width: 500px;"
          >
          <button onclick="findUser()">
            Search
          </button>

          <div id="foundUser" style="margin-top:20px;"></div>

        </div>
      </div>

      <!-- PENDING -->
      <div id="sec-pending" class="admin-section">
        <div class="card">
          <h2>Pending Registrations</h2>
          <div id="pendingList" style="margin-top:20px;"></div>
        </div>
      </div>

      <!-- SUPPORT -->
      <div id="sec-support" class="admin-section">
        <div class="card">
          <h2>Support Inbox</h2>
          <div id="adminSupportList"></div>
        </div>
      </div>
    </div>
  </div>
</div>


<footer class="site-footer hidden" id="simpleFooter"> ¬© 2026 ADS 250 | All rights reserved </footer>
<script>
const API = "https://ads-auth.sifatraj280.workers.dev";
const SESSION_DURATION = 30 * 60 * 1000;

document.addEventListener("click", function(e){
  const modal = document.getElementById("routineModal");
  if(!modal || modal.classList.contains("hidden")) return;

  if(e.target === modal){
    modal.classList.add("hidden");
  }
});

/* ---------- NAV ---------- */
function hideAll(){
  ["login","register","setPassword","dashboard","specialProgram","specialCourseView","profile",
  "admin","supportPage","supportFormPage","contactInfoPage"]
  .forEach(id => {
    const el = document.getElementById(id);
    if(el){
    el.style.display = "none";
    el.classList.add("hidden");
    }
  });
}
function showLogin(){
  hideAll();
  app.classList.add("hidden");        // üî• IMPORTANT
  app.style.display = "none";
  const nav = document.querySelector("#app nav");
  nav.style.display = "none";
  login.style.display = "flex";
}
function showRegister(){
  hideAll();
  app.classList.add("hidden");        // üî• IMPORTANT
  app.style.display = "none";
  const nav = document.querySelector("#app nav");
  nav.style.display = "none";
  register.style.display = "flex";
}
function showDashboard(){
  hideAll();
  app.classList.remove("hidden");     // üî• SYNC CLASS
  app.style.display = "flex";
  const nav = document.querySelector("#app nav");
  nav.style.display = "flex";         // üî• ONLY PLACE nav shows
  dashboard.style.display = "block";
  updateFooter("All rights reserved");
  updateWelcomeName();
  const session = JSON.parse(localStorage.getItem("auth_session") || "{}");
  const adminNav = document.getElementById("adminNav");
  const supportNav = document.getElementById("supportNav");
  if (session.user?.isAdmin) {
    adminNav.style.display = "block";
    supportNav.style.display = "none";
  } else {
    adminNav.style.display = "none";
    supportNav.style.display = "block";
  }
  if (session.user?.isAdmin) {
    adminNav.style.display = "block";
  } else {
    adminNav.style.display = "none";
  }

}
function showAdmin(){
  const session = JSON.parse(localStorage.getItem("auth_session") || "{}");
  if (!session.user?.isAdmin) {
    alert("Unauthorized access");
    return;
  }
  hideAll();
  app.classList.remove("hidden");
  app.style.display = "flex";
  document.querySelector("#app nav").style.display = "flex";
  admin.classList.remove("hidden");
  admin.style.display = "block";

  // üî• AUTO UNLOCK
  if (window.adminUnlock) adminUnlock.classList.add("hidden");
  document.getElementById("adminTools")?.classList.remove("hidden");
  switchAdmin('find');
  loadPendingUsers();
  loadAdminSupportInbox();
  updateFooter("Admin"); 
}

/* ---------- PROFILE ---------- */
function showProfile(){
  hideAll();
  app.classList.remove("hidden");   // üîì MUST
  app.style.display = "flex";
  document.querySelector("#app nav").style.display = "flex";
  profile.classList.remove("hidden");
  profile.style.display = "block";
  updateFooter("Profile");

  const session = JSON.parse(localStorage.getItem("auth_session") || "{}");
  const user = session.user || {};
  
  profileData.innerHTML = `
  <div class="grid" style="text-align:left">

    <!-- CARD 1: BASIC INFO -->
    <div class="card">
      <div class="avatar">${user.name?.[0] || "U"}</div>
      <h2>${user.name}</h2>

      <p>üìß <b>Email</b><br>${user.email}</p>
      <p>üéì <b>Student ID</b><br>${user.studentId}</p>

      <button onclick="logout()" style="margin-top:15px">
        üö™ Logout
      </button>
    </div>

    <!-- CARD 2: ACADEMIC TIMELINE -->
    <div class="card">
      <h2>Academic Timeline</h2>
      <h3>BSc in Artificial Intelligence & Data Science</h3>
      <p>‚Ä¢ Batch: <b>${user.batch || "Not Assigned"}</b></p>
      <p>‚Ä¢ Session: Spring 2026 (Ongoing)</p>
      <p>‚Ä¢ Academic Level: Undergraduate</p>
      <p>‚Ä¢ Program Duration: 4 Years</p>
      <p>‚Ä¢ Total Semesters: 12</p>
    </div>
    <!-- CARD 3: NOTICE -->
    <div class="card">
    <h3>üì¢ Notice</h3>
    <p class="notice-highlight">Mid-term starts from 06 March.</p>
    <h3>üìë Exam Schedule</h3>
    <div style="display:flex;gap:10px;flex-wrap:wrap">
      <button onclick="showExam('mid')">Mid-term</button>
      <button onclick="showExam('final')">Final</button>
    </div>
    <div id="examAction" style="margin-top:12px"></div> 
    </div>
    <!-- CARD 4: MY SUPPORT REQUESTS -->
    <div class="card support-history-card">
      <h3>üõ† My Support Requests</h3>
      <div id="mySupportList" class="support-list">
        <p class="support-loading">Loading your requests...</p>
      </div>
    </div>
  `;
  if(!user.isAdmin){
    setTimeout(()=>{
      loadMySupportRequests();
    },0);
  }else{
    const sec=document.querySelector(".support-history-card");
    if(sec) sec.style.display="none";
  }

  // üî• FORCE BATCH SETUP FOR OLD USERS
  if(!user.batch){
    document.getElementById("batchModal").classList.remove("hidden");
  }
}
/* ---------- SEMESTER ---------- */
function openSemester(){
  semesterList.classList.add("hidden");
  semester.classList.remove("hidden");
  updateFooter("Spring Semester 2026");
}
function goBack(){
  semester.classList.add("hidden");
  semesterList.classList.remove("hidden");
  updateFooter("All rights reserved");
}

/* ---------- REGISTER ---------- */
async function doRegister(){
  const name = regName.value.trim();
  const studentId = regId.value.trim();
  const email = regEmail.value.trim();
  const batchNum = regBatchNum.value.trim();
  // empty check
  if (!name || !studentId || !email) {
    regResult.innerText = "All fields are required";
    return;
  }
  // Student ID must be integer
  if (!/^\d+$/.test(studentId)) {
    regResult.innerText = "Student ID must be a valid number";
    return;
  }
  // Email validation
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailRegex.test(email)) {
    regResult.innerText = "Please enter a valid email address";
    return;
  }
  const res = await fetch(API + "/register", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      name,
      studentId,
      email,
      batch: "ADS-" + batchNum,
    })
  });
  const data = await res.json();
  if (!res.ok) {
    regResult.innerText = data.error || "Registration failed";
    return;
  }
  regResult.innerHTML = `
  <div style="
    margin-top:15px;
    padding:14px;
    border-radius:12px;
    background:#022c22;
    color:#22c55e;
    text-align:center;
  ">
    <p><b>Registration Successful</b></p>
    <p>Your Temporary Password</p>
    <h2 style="letter-spacing:2px">${data.tempPassword}</h2>
    <small>
      ‚ö†Ô∏è This password will work only after admin approval.<br>
      Please save it carefully.
    </small>
  </div>
`;
}

/* ---------- LOGIN ---------- */
async function doLogin(){
  const btn = document.getElementById("loginBtn");
  btn.innerText = "Accessing...";
  btn.disabled = true;
  const studentId = loginId.value.trim();
  const otp = loginOtp.value.trim();
  if(!studentId || !otp){
    loginError.innerText="Student ID and Passcode required";
    return;
  }

  const res = await fetch(API+"/login",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({studentId,password: otp})

  });

  const data = await res.json();
  if(!res.ok){
    btn.innerText = "Access Portal";
    btn.disabled = false;
    loginError.innerText=data.error;
    return;
  }

  const profile = {
  name: data.name,
  studentId,
  email: data.email,
  batch: data.batch,
  isAdmin: data.isAdmin === true
};

  localStorage.setItem("auth_session", JSON.stringify({
  user: profile,
  loginTime: Date.now()
}));
  btn.innerText = "Access Portal";
  btn.disabled = false;

  if (data.mustChangePassword) {
  hideAll();
  setPassword.style.display = "flex";
} else {
  showDashboard();
}
}

/* ---------- LOGOUT ---------- */
function logout(){
  localStorage.removeItem("auth_session");
  location.reload();
}

/* ===== ADD START: 4-level logic (NO existing change) ===== */
let currentCourse="", currentExam="";

const driveLinks={
  "Introduction to Data Science":{ "Mid-Term":{materials:"https://drive.google.com/drive/folders/1Xp9ExGdaMFP-tEDOcXe_nMFQNx-qf9ff",resources:"https://drive.google.com/drive/folders/1me-kPCjlg2lkYhMt8nIo1Sb_9-V8GFgt"},
                  "Final":{materials:"https://drive.google.com/drive/folders/1g9ZWYrxDFp6cN9Tl_oAjFmdHbo0i9yGn",resources:"https://drive.google.com/drive/folders/1fNsP-UVGRA-jAo0Iq0wKjpwI3q9qaNz0"}},
  "Physics":{ "Mid-Term":{materials:"https://drive.google.com/drive/folders/1mWdjn-bPRfhfNVMLn99AE-7iZlPYXR8J",resources:"https://drive.google.com/drive/folders/1EHVW1fpej1KGaZpPdOQgdIHxKcgM4b5D"},
              "Final":{materials:"https://drive.google.com/drive/folders/1en4CruG9nBhXwK9MltiY82j_GMntye2L",resources:"https://drive.google.com/drive/folders/1_qGAkiH5Vf_U7GZcO2JyJFrkXVaXiyGO"}},
  "Linear Algebra":{ "Mid-Term":{materials:"https://drive.google.com/drive/folders/1KlMnxFWVkcIhd66BUvlohIOc9b1N953Q",resources:"https://drive.google.com/drive/folders/1G6T40uJsXDQA7Ermli5ThOAIvrZgle-g"},
                     "Final":{materials:"https://drive.google.com/drive/folders/1tbdu7TPKU0w03GbssICQamYrXPIGVhzu",resources:"https://drive.google.com/drive/folders/1j4tChwBkQd6p3UGiT1lQJbmUfO4YsACm"}},
  "Professional English":{ "Mid-Term":{materials:"https://drive.google.com/drive/folders/1OMMcheIQK8A2BB7KzX9QqNnjAjKrc8OM",resources:"https://drive.google.com/drive/folders/16qp3S_Sx-axHmDkvUoGgME4NORZqQw81"},
                            "Final":{materials:"https://drive.google.com/drive/folders/16pan3rzXkFE1KQ-6qNviaD4vryvbIxZX",resources:"https://drive.google.com/drive/folders/1VTYy4SxTPG8FvHCgWIPbzy4SQKjkHNDu"}},
  "Physics Lab":{ "Mid-Term":{materials:"https://drive.google.com/XXXX",resources:"https://drive.google.com/XXXX"},
                  "Final":{materials:"https://drive.google.com/XXXX",resources:"https://drive.google.com/XXXX"}},
  "Professional Life Skill Development":{ "Mid-Term":{materials:"https://drive.google.com/drive/folders/1A8NQ2uzFXIplFlfdqhyZILat6IqcuY5P",resources:"https://drive.google.com/drive/folders/1RZgT4L_K-eBdDkDTCFsWXM2KZMHdkDEc"},
                                          "Final":{materials:"https://drive.google.com/drive/folders/1ncRDAClQSUpt-XKxxyKCJDLo5OTRwPDS",resources:"https://drive.google.com/drive/folders/15vVAgmELPG78JoZXSYw8M9uWFec4khsk"}}
};

document.querySelectorAll("#semester .grid .card").forEach(card=>{
  card.addEventListener("click",()=>{
    currentCourse=card.querySelector("h2").innerText.trim();
    semester.classList.add("hidden");
    courseView.classList.remove("hidden");
    courseTitle.innerText=currentCourse;
    updateFooter(currentCourse);
  });
});

function openExam(e){
  currentExam=e;
  courseView.classList.add("hidden");
  examView.classList.remove("hidden");
  examTitle.innerText=e;
  updateFooter(currentCourse + " / " + e);
}
function backToCourse(){
  examView.classList.add("hidden");
  courseView.classList.remove("hidden");
  updateFooter(currentCourse);
}
function backToSemester(){
  courseView.classList.add("hidden");
  semester.classList.remove("hidden");
  updateFooter("Spring Semester 2026");
}
function openDrive(t){
  window.open(driveLinks[currentCourse][currentExam][t],"_blank");
}

function updateFooter(text){
  console.log("FOOTER UPDATE:", text);

  const footer = document.getElementById("simpleFooter"); // üî• FIX
  if(footer){
    footer.innerText = "¬© 2026 ADS 250 | " + text;
  }
}

/* ===== ENTER KEY SUPPORT ===== */

// login enter
if (typeof loginOtp !== "undefined") {
  loginOtp.addEventListener("keydown", function(e){
    if(e.key === "Enter"){
      doLogin();
    }
  });
}

function updateWelcomeName(){
  const session = JSON.parse(localStorage.getItem("auth_session") || "{}");
  const user = session?.user || {};
  const name = user.name || "Student";
  const el = document.getElementById("welcomeText");
  if(!el) return;
  if(user.isAdmin){
    el.innerHTML =
      "Welcome back, " + name +
      ' <span style="background:#ef4444;color:#fff;padding:3px 8px;border-radius:6px;font-size:12px;margin-left:6px;">ADMIN</span>';
  }else{
    el.innerText = "Welcome back, " + name + " üëã";
  }
}

function showSpecialProgram(){
  hideAll();
  app.style.display = "flex";
  specialProgram.style.display = "block";
  updateFooter("Special Program");
}
function backToSpecialProgram(){
  hideAll();
  app.style.display = "flex";
  specialProgram.style.display = "block";
  updateFooter("Special Program");
}
const specialCourses = {
  "Computer Programming": [
    { key: "materials", label: "üìÅ Class Materials" },
    { key: "resources", label: "üìö Resources" },
    { key: "recorded", label: "üé• Recorded Class" },
    { key: "lab", label: "üî¨ Computer Programming Lab" }
  ],
  "Discrete Mathematics": [
    { key: "materials", label: "üìÅ Class Materials" },
    { key: "resources", label: "üìö Resources" }
  ]
};

const specialDriveLinks = {
  "Computer Programming": {
    materials: "https://drive.google.com/drive/folders/1tsXIhNLZrT3ByPgl288j7D2AQt0jeYZn",
    resources: "https://drive.google.com/drive/folders/1SEXXEilvj54f4Iffo1lnKcz_7X7fcaQ4",
    recorded: "https://drive.google.com/drive/folders/17ge6bu2pd7B0O55-mCBOxcQeuRHwECpc",
    lab: "https://drive.google.com/drive/folders/1sZ28CQwxTJ48blQbiDnzxMlVSiPXDMzv"
  },
  "Discrete Mathematics": {
    materials: "https://drive.google.com/drive/folders/1BwSU5hLRsorJwbNX0wDPvONgldr8gzjN",
    resources: "https://drive.google.com/drive/folders/1Ul-3QmS81pcqxDSh8keAnqrWPYkTKysc"
  }
};

function openSpecialCourse(courseName){
  hideAll();
  app.style.display = "flex";
  specialCourseView.style.display = "block";
  specialCourseTitle.innerText = courseName;
  updateFooter(courseName);

  const box = document.getElementById("specialOptions");
  box.innerHTML = "";

  specialCourses[courseName].forEach(item => {
    const div = document.createElement("div");
    div.className = "option-card";
    div.innerHTML = `<h3>${item.label}</h3>`;
    div.onclick = () => {
      window.open(
        specialDriveLinks[courseName][item.key],
        "_blank"
      );
    };
    box.appendChild(div);
  });
}
function backToDashboard(){
  document.getElementById("specialProgram").style.display = "none";
  showDashboard();
}
// ===== STEP 3: ADMIN PENDING + APPROVE =====
async function loadPendingUsers(){
  const session = JSON.parse(localStorage.getItem("auth_session") || "{}");
  const res = await fetch(API + "/admin-pending", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      adminId: session.user.studentId
    })
  });
  const data = await res.json();
  const box = document.getElementById("pendingList");
  box.innerHTML = "";
  if (!data.pending || data.pending.length === 0) {
    box.innerHTML = "<p>No pending requests</p>";
    return;
  }
  data.pending.forEach(user => {
    const div = document.createElement("div");
    div.className = "card";
    div.style.margin = "14px 0";
    div.style.boxSizing = "border-box";
    div.innerHTML = `
      <p><b>${user.name}</b></p>
      <p>ID: ${user.studentId}</p>
      <p>${user.email}</p>
      <button onclick="approveUser('${user.studentId}')">
        Approve
      </button>
      <button onclick="rejectUser('${user.studentId}')" style="background:#dc2626;">
        Reject
      </button>
    `;
    box.appendChild(div);
  });
  document.getElementById("pendingCount").innerText = data.pending.length;
}

async function setNewPassword(e){
  e.preventDefault();
  const p1 = newPass.value.trim();
  const p2 = confirmPass.value.trim();

  if(p1 !== p2){
    alert("Passwords do not match");
    return;
  }
  const session = JSON.parse(localStorage.getItem("auth_session"));
  if(!session){
  alert("Session expired");
  return;
  }
  const res = await fetch(API + "/set-password", {
    method: "POST",
    headers: { "Content-Type":"application/json" },
    body: JSON.stringify({
      studentId: session.user.studentId,
      newPassword: p1
    })
  });
  if(res.ok){
    localStorage.removeItem("auth_session");
    alert("Password updated. Please login again.");
    location.reload();
  } else {
    alert("Failed to set password");
  }
}
async function approveUser(studentId){
  const session = JSON.parse(localStorage.getItem("auth_session") || "{}");

  const res = await fetch(API + "/admin-approve", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      studentId,
      adminId: session.user.studentId
    })
  });
  const data = await res.json();
  alert(data.message || "Approved");
  loadPendingUsers();
}
async function rejectUser(studentId){
  const session = JSON.parse(localStorage.getItem("auth_session") || "{}");
  if(!confirm("Reject this user?")) return;
  const res = await fetch(API + "/admin-reject", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      studentId,
      adminId: session.user.studentId
    })
  });
  const data = await res.json();
  alert(data.message || "Rejected");
  loadPendingUsers();
}
async function findUser(){
  const session = JSON.parse(localStorage.getItem("auth_session") || "{}");
  const studentId = searchStudentId.value.trim();
  if(!studentId){
    foundUser.innerText = "Enter Student ID";
    return;
  }
  const res = await fetch(API + "/admin-find-user", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      studentId,
      adminId: session.user.studentId
    })
  });
  const data = await res.json();
  if(!res.ok){
    foundUser.innerText = data.error || "User not found";
    return;
  }
  foundUser.innerHTML = `
    <div class="card">
      <h3>${data.name}</h3>
      <p>Email: ${data.email}</p>
      <p style="color:#22c55e">
        Password: ${data.password}
      </p>
      <p>
        mustChangePassword: ${data.mustChangePassword}
      </p>
    </div>
  `;
}

window.onload = () => {
  const session = JSON.parse(localStorage.getItem("auth_session") || "{}");

  hideAll();

  if (
    session.loginTime &&
    Date.now() - session.loginTime < SESSION_DURATION
  ) {
    showDashboard(); // ‚úÖ ONLY ENTRY POINT
  } else {
  localStorage.removeItem("auth_session");
  app.style.display = "none";              // üî• ADD
  document.querySelector("#app nav").style.display = "none"; // üî• ADD
  login.style.display = "flex";}

  document.getElementById("simpleFooter").style.display = "block";
};
function setNotice(text){
  const el = document.getElementById("noticeText");
  if(el) el.innerText = text;
}
function showExam(type){
  const box = document.getElementById("examAction");
  if(!box) return;
  if(type === "mid"){
    box.innerHTML = `
      <button onclick="openRoutine('mid')">
        üìÑ View Mid-term Routine
      </button>
    `;
  }
  if(type === "final"){
    box.innerHTML = `
      <button onclick="openRoutine('final')">
        üìÑ View Final Routine
      </button>
    `;
  }
}
function openRoutine(type){
  const modal = document.getElementById("routineModal");
  const title = document.getElementById("routineTitle");
  const img   = document.getElementById("routineImage");

  let src = "";
  let label = "";

  if(type === "mid"){
    src = "midterm.png";
    label = "Mid-term";
    title.innerText = "Mid-term Exam Routine";
  }

  if(type === "final"){
    src = "final.png";
    label = "Final";
    title.innerText = "Final Exam Routine";
  }

  // üîç check if image exists
  const testImg = new Image();
  testImg.onload = function(){
    img.src = src;
    modal.classList.remove("hidden");
  };
  testImg.onerror = function(){
    alert(label + " routine is not published yet. Please wait.");
  };
  testImg.src = src;
}
window.closeRoutine = function(){
  const modal = document.getElementById("routineModal");
  if(modal){
    modal.classList.add("hidden");
  }
};
async function saveBatch(){
  const num = document.getElementById("setupBatchNum").value.trim();
  if(!num){
    alert("Batch number is required");
    return;
  }
  const session = JSON.parse(localStorage.getItem("auth_session") || "{}");
  if(!session.user){
    alert("Session expired");
    location.reload();
    return;
  }
  const batch = "ADS-" + num;
  const res = await fetch(API + "/set-batch", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      studentId: session.user.studentId,
      batch
    })
  });
  if(!res.ok){
    alert("Failed to save batch");
    return;
  }
  session.user.batch = batch;
  localStorage.setItem("auth_session", JSON.stringify(session));

  document.getElementById("batchModal").classList.add("hidden");
  showProfile();
}
function showSupport(){
  hideAll();
  app.style.display = "flex";
  document.querySelector("#app nav").style.display = "flex";
  supportPage.classList.remove("hidden");
  supportPage.style.display = "block";
  updateFooter("Support Center");
}

function openSupportForm(type){
  hideAll();
  app.style.display = "flex";
  document.querySelector("#app nav").style.display = "flex";

  supportFormPage.classList.remove("hidden");
  supportFormPage.style.display = "block";

  const subjectBox = document.getElementById("supportSubject");
  if(type === "materials"){
      subjectBox.placeholder =
        "Request to upload notes for ADS-201 or ask for missing materials";
  }
  else{
      subjectBox.placeholder = "Subject";
  }
  const map = {
    materials: {
      title: "Request for Upload Materials or Notes",
      subject: ""
    },
    feedback: {
      title: "Feedback",
      subject: ""
    },
    bug: {
      title: "Report a Problem",
      subject: ""
    },
    contact: {
      title: "Contact Us",
      subject: ""
    }
  };
  const cfg = map[type];
  document.getElementById("supportFormTitle").innerText = cfg.title;
  document.getElementById("supportType").value = type;
  document.getElementById("supportSubject").value = cfg.subject;
  document.getElementById("supportMessage").value = "";
}
async function submitSupport(){

  const session = JSON.parse(localStorage.getItem("auth_session") || "{}");

  const type = document.getElementById("supportType").value;
  const subject = document.getElementById("supportSubject").value.trim();
  const message = document.getElementById("supportMessage").value.trim();

  if(!session.user){
    alert("Login required");
    return;
  }

  if(!subject || !message){
    alert("Subject & message required");
    return;
  }

  try{
    const res = await fetch(API + "/support-create", {
      method: "POST",
      headers: { "Content-Type":"application/json" },
      body: JSON.stringify({
        studentId: session.user.studentId,
        type,
        subject,
        message
      })
    });

    const data = await res.json();

    if(res.ok){
      alert("‚úÖ Submitted successfully!");
      showProfile();
    }else{
      alert(data.error || "Submit failed");
    }

  }catch(err){
    alert("Network / CORS error ‚ùå");
  }
}

async function loadMySupportRequests(){
  const session = JSON.parse(localStorage.getItem("auth_session") || "{}");
  if(!session.user) return;

  const list = document.getElementById("mySupportList");
  if(!list) return;

  try{
    const res = await fetch(API + "/support-list-user", {
      method: "POST",
      headers: { "Content-Type":"application/json" },
      body: JSON.stringify({
        studentId: session.user.studentId
      })
    });

    const data = await res.json();

    if(!data.requests || data.requests.length === 0){
      list.innerHTML =
        "<div class='support-empty'>No support requests submitted yet.</div>";
      return;
    }

    list.innerHTML = "";

    data.requests.forEach(r => {
      const item = document.createElement("div");
      item.className = "support-item";

      const date = r.updatedAt
        ? new Date(r.updatedAt).toLocaleDateString()
        : "";

      item.innerHTML = `
        <div class="support-info">
          <div class="support-title">${r.subject}</div>

          <div class="support-meta">
            ${r.type.toUpperCase()} ‚Ä¢ ${date}
          </div>
          ${r.adminNote ? `
            <div style="
              margin-top:6px;
              font-size:12px;
              color:${r.status==="rejected"
              ? "#facc15"
              : r.status==="resolved"
              ? "#22c55e"
              : "#38bdf8"};
            ">
              Admin Note: ${r.adminNote}
            </div>
          ` : ""}
        </div>

        <div class="support-status ${r.status === "open" ? "pending" : r.status}">
          ${r.status.toUpperCase()}
        </div>
      `;

      list.appendChild(item);
    });

  }catch(e){
    list.innerHTML =
      "<div class='support-empty'>Failed to load requests</div>";
  }
}

function showContactInfo(){
  hideAll();
  app.style.display = "flex";
  document.querySelector("#app nav").style.display = "flex";

  contactInfoPage.classList.remove("hidden");
  contactInfoPage.style.display = "block";

  updateFooter("Contact Information");
}
async function loadAdminSupportInbox(){
  const session = JSON.parse(localStorage.getItem("auth_session") || "{}");
  if(!session.user?.isAdmin) return; 
  const box = document.getElementById("adminSupportList");
  if(!box) return;
  box.innerHTML = "<p style='opacity:.6'>‚è≥ Loading open support requests...</p>";
  try{
    const res = await fetch(API + "/support-list-admin", {
      method: "POST",
      headers: { "Content-Type":"application/json" },
      body: JSON.stringify({
        adminId: session.user.studentId
      })
    });

    const data = await res.json();

    if(!data.requests || data.requests.length === 0){
      box.innerHTML = "<p>No support requests.</p>";
      return;
    }

    box.innerHTML = "";

    const openRequests = data.requests.filter(r => r.status === "open");

    if(openRequests.length === 0){
      box.innerHTML = "<p>üéâ No open support requests.</p>";
      return;
    }
    openRequests
      .sort((a,b)=>b.updatedAt - a.updatedAt)
      .forEach(r => {
        const div = document.createElement("div");
        div.className = "card";
        div.style.marginBottom = "14px 0";
        div.style.boxSizing = "border-box";

        div.innerHTML = `
          <p><b>${r.subject}</b></p>
          <p style="opacity:.75">
            ${r.studentId} ‚Ä¢ ${r.type.toUpperCase()}
          </p>
          <p style="font-size:13px;opacity:.7">${r.message}</p>

          <select id="status-${r.id}">
            <option value="open" ${r.status==="open"?"selected":""}>Open</option>
            <option value="resolved" ${r.status==="resolved"?"selected":""}>Resolved</option>
            <option value="rejected" ${r.status==="rejected"?"selected":""}>Rejected</option>
          </select>
          <textarea id="note-${r.id}"
              placeholder="Admin note..."
              style="width:100%;margin-top:8px;"></textarea>
          <button onclick="updateSupportStatus('${r.id}', document.getElementById('note-${r.id}').value)">
            Update
          </button>
        `;
        box.appendChild(div);
      });
      document.getElementById("supportCount").innerText = openRequests.length;

  }catch(e){
    box.innerHTML = "<p>Failed to load support inbox</p>";
  }
}
async function updateSupportStatus(requestId, note){
  const select = document.getElementById("status-" + requestId);
  if(!select){
    alert("Status selector not found");
    return;
  }

  const status = select.value;
  const noteField = document.getElementById("note-" + requestId);
  const adminNote = noteField.value.trim();

  if((status === "resolved" || status === "rejected") && adminNote === ""){
    alert("Admin note required!");
    noteField.focus();
    return;
  }

  const session = JSON.parse(localStorage.getItem("auth_session") || "{}");
  if(!session.user?.isAdmin){
    alert("Unauthorized");
    return;
  }

  const res = await fetch(API + "/support-update-status", {
    method: "POST",
    headers: { "Content-Type":"application/json" },
    body: JSON.stringify({
      adminId: session.user.studentId,
      requestId,
      status,
      adminNote
    })
  });

  const data = await res.json();

  if(res.ok){
    alert("Status updated");
    loadAdminSupportInbox();
  }else{
    alert(data.error || "Failed to update status");
  }
}
function switchAdmin(type){

  // hide all
  document.querySelectorAll(".admin-section")
    .forEach(sec => sec.classList.remove("active"));

  // show selected
  const target = document.getElementById("sec-" + type);
  if(target){
    target.classList.add("active");
  }

}

</script>

<!-- BATCH SETUP MODAL -->
<div id="batchModal" class="modal hidden">
  <div class="modal-box" style="max-width:420px;height:auto">
    <h3 style="color:#facc15">‚ö† Academic Information Required</h3>

    <p style="opacity:.85;margin:10px 0 18px">
      Please set your batch number to continue.
    </p>

    <div style="display:flex;gap:10px;margin-bottom:16px">
      <input value="ADS" disabled style="width:30%; background:#0f172a;
      color:#22d3ee; font-weight:700; text-align:center; opacity:1; border:1px solid #1f2937;">
      <input id="setupBatchNum" type="number" placeholder="Batch (e.g. 250)" style="width:70%">
    </div>

    <button onclick="saveBatch()">Save</button>
  </div>
</div>

<!-- ROUTINE MODAL -->
<div id="routineModal" class="modal hidden">
  <div class="modal-box">
    <h3 id="routineTitle"></h3>
    <div class="modal-content">
      <img id="routineImage" src="" alt="Routine">
    </div>
    <button onclick="closeRoutine()">Close</button>
  </div>
</div>
</body>
</html>
