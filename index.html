<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Artificial Intelligence and Data Science</title>
<link href="https://fonts.googleapis.com/css2?family=Tektur:wght@400;500;600&display=swap" rel="stylesheet">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="favicon.png">
<link rel="shortcut icon" href="favicon.png">
<link rel="apple-touch-icon" href="favicon.png">
  
<style>
:root {
  --bg-dark:#0b1220;
  --bg-card:#2a3445;
  --green:#00c853;
  --text:#e5e7eb;
  --neon-blue:#22d3ee;
  --neon-green:#22c55e;
  --neon-pink:#f472b6;
}
body {
  margin:0;
  font-family:"Tektur",sans-serif;
  color:var(--text);
  background:
    radial-gradient(circle at 20% 20%, #1f2937 0%, transparent 40%),
    radial-gradient(circle at 80% 30%, #0ea5e9 0%, transparent 35%),
    radial-gradient(circle at 50% 80%, #22c55e 0%, transparent 40%),
    linear-gradient(120deg,#020617,#0b1220,#111827);
  background-attachment: fixed;
}
.hidden{display:none}
.center{
  height:100vh;
  display:none;          /* üî• ADD */
  justify-content:center;
  align-items:center;
  position:fixed;
  top:0;
  left:0;
  width:100%;
  background:inherit;
}
.box{
  background: linear-gradient(180deg,#020617,#020617cc);
  padding:36px;
  border-radius:22px;
  width:100%;
  max-width:420px;
  box-sizing:border-box;

  border:1px solid rgba(255,255,255,.08);
  backdrop-filter: blur(14px);

  box-shadow:
    0 30px 60px rgba(0,0,0,.55),
    inset 0 0 0 1px rgba(255,255,255,.04);
}

input,button{
  width:80%;padding:12px;margin-bottom:12px;
  border:none;border-radius:8px
}
button{
  background:linear-gradient(135deg,#22c55e,#06b6d4);
  color:white;
  border:none;
  padding:12px 18px;
  border-radius:12px;
  font-weight:600;
  letter-spacing:.4px;
  cursor:pointer;
  position:relative;
  overflow:hidden;
}
button::after{
  content:"";
  position:absolute;
  inset:0;
  background:linear-gradient(120deg,transparent,rgba(255,255,255,.35),transparent);
  transform:translateX(-100%);
  transition:.5s;
}
button:hover::after{
  transform:translateX(100%);
}


nav{
  background:rgba(0,0,0,.45);
  backdrop-filter: blur(16px);
  border-bottom:1px solid rgba(255,255,255,.08);
  padding:15px 30px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.logo{font-size:22px;font-weight:bold;color:white}
nav ul{list-style:none;display:flex;gap:25px;margin:0;padding:0}
nav li{cursor:pointer;color:white}

.container{max-width:1100px;margin:auto;padding:40px 20px;text-align:center}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:25px}
.card{
  background: rgba(42,52,69,0.55);
  backdrop-filter: blur(12px);
  border:1px solid rgba(255,255,255,0.08);
  padding:30px;
  border-radius:20px;
  position:relative;
  overflow:hidden;
}
.card::before{
  content:"";
  position:absolute;
  inset:0;
  background:linear-gradient(120deg,transparent,rgba(56,189,248,.25),transparent);
  opacity:0;
  transition:.4s;
}
.card:hover::before{
  opacity:1;
}

.card h2{color:#38bdf8}

/* ===== ADD START: new UI only ===== */
.option-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:25px;
  margin-top:30px;
}
.option-card{
  background:var(--bg-card);
  padding:25px;
  border-radius:18px;
  cursor:pointer;
}
.option-card h3{color:#38bdf8}
/* ===== ADD END ===== */

@keyframes fadeIn {
  from { opacity:0; transform:scale(0.98); }
  to   { opacity:1; transform:scale(1); }
}

#app .container{
  animation: fadeIn 0.35s ease-in-out;
}


.card,
.option-card{
  transition: transform 0.25s ease, box-shadow 0.25s ease;
}

.card:hover,
.option-card:hover{
  transform: translateY(-6px);
  box-shadow: 0 10px 25px rgba(144, 13, 13, 0.3);
}

.fade{
  animation: fadeIn 0.35s ease-in-out;
}

/* ===== Back button animation ===== */
.back-btn,
button[onclick^="goBack"],
button[onclick^="back"]{
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.back-btn:hover,
button[onclick^="goBack"]:hover,
button[onclick^="back"]:hover{
  transform: translateX(-4px);
  box-shadow: 0 6px 15px rgba(0,0,0,0.25);
}

.back-btn:active,
button[onclick^="goBack"]:active,
button[onclick^="back"]:active{
  transform: scale(0.95);
}

/* Login & Register buttons animation */
#login button,
#register button{
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

#login button:hover,
#register button:hover{
  transform: translateY(-3px);
  box-shadow: 0 6px 15px rgba(0,0,0,0.3);
}

#login button:active,
#register button:active{
  transform: scale(0.95);
}

/* Login/Register text link animation */
#login p,
#register p{
  transition: color 0.2s ease, transform 0.2s ease;
}

#login p:hover,
#register p:hover{
  transform: translateX(4px);
  color:#7dd3fc;
}

.card:hover,
.option-card:hover{
  transform: translateY(-6px);
  box-shadow: 0 10px 25px rgba(0,0,0,0.3);
}

#login input:focus,
#register input:focus{
  outline:none;
  border:2px solid #38bdf8;
  background:#020617;
  box-shadow: 0 0 0 3px rgba(56,189,248,0.25);
  transform: scale(1.03);
}

.site-footer{
  margin-top:auto;
  padding: 15px 0;
  font-size:15px;
  color:#9ca3af;
  text-align:center;
  background:var(--bg-dark);
}

/* ===== FONT POLISH ===== */
h1, h2, h3, .logo {
  font-weight:600;
  letter-spacing:0.5px;
}
button {
  font-family: "Tektur", sans-serif;
  font-weight:500;
}
input {
  font-family: "Tektur", sans-serif;
}

/* ===== NAVBAR ANIMATION ===== */
#app:not(.hidden) nav{
  animation: navSlide 0.6s ease-out;
}


@keyframes navSlide{
  from{ transform: translateY(-100%); opacity:0; }
  to{ transform: translateY(0); opacity:1; }
}

.logo{
  animation: logoPop 0.6s ease-out 0.3s both;
}

@keyframes logoPop{
  from{ transform: scale(0.8); opacity:0; }
  to{ transform: scale(1); opacity:1; }
}

nav li{
  position:relative;
  transition: transform 0.25s ease, opacity 0.25s ease;
}

nav li:hover{
  transform: translateY(-3px);
  opacity:0.9;
}

nav li::after{
  content:"";
  position:absolute;
  left:0;
  bottom:-6px;
  width:0;
  height:2px;
  background:white;
  transition: width 0.3s ease;
}

nav li:hover::after{
  width:100%;
}

/* sticky footer layout */
#app{
  min-height:100vh;
  display:flex;
  flex-direction:column;
}

#dashboard{
  flex:1;
}

#login input,
#register input{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:1px solid #1f2937;
  background:#020617;
  color:#e5e7eb;
  transition:.25s;
}

#login input:focus,
#register input:focus{
  border-color:#22d3ee;
  box-shadow:0 0 0 4px rgba(34,211,238,.15);
  transform:translateY(-1px);
}
.hero{
  text-align:left;
  padding:30px;
  border-radius:20px;
  margin-bottom:30px;
  background:
    linear-gradient(135deg,rgba(56,189,248,.15),rgba(34,197,94,.12));
  border:1px solid rgba(255,255,255,.08);
}
.hero h1{font-size:28px;margin:0 0 8px}
.hero p{opacity:.8}

.avatar{
  width:90px;
  height:90px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:36px;
  margin:0 auto 14px;
  background:linear-gradient(135deg,#22d3ee,#22c55e);
  color:#022c22;
}
.meta{margin-top:18px;display:grid;gap:12px}
.meta label{font-size:12px;opacity:.6}

#admin .card{
  border:1px solid rgba(239,68,68,.25);
  box-shadow:0 0 30px rgba(239,68,68,.08);
}
#admin button{
  background:linear-gradient(135deg,#ef4444,#dc2626);
}
#admin input{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:1px solid #1f2937;
  background:#020617;
  color:#e5e7eb;
  font-family:"Tektur",sans-serif;
  z-index:5;
  position:relative;
}
.login-brand{
  display:grid;
  grid-template-columns: 80px 1fr 80px;
  align-items:center;
  margin-bottom:22px;
}

.brand-logo{
  width:68px;
  height:68px;
  object-fit:contain;

  filter:
    drop-shadow(0 0 12px rgba(34,211,238,.9))
    drop-shadow(0 0 28px rgba(34,211,238,.45));
}

.brand-title{
  font-size:25px;
  letter-spacing:1px;
  font-weight:600;
  color:#22d3ee;
  text-shadow:
    0 0 12px rgba(34,211,238,.8),
    0 0 26px rgba(34,211,238,.35);
}

.brand-sub{
  font-size:15px;
  font-weight:500;
  opacity:.95;
  letter-spacing:1px;
}
.brand-text{
  text-align:center;
  line-height:1.3;
  justify-self:center;
}
.brand-logo-right{
  width:92px;
  height:92px;

  filter:
    drop-shadow(0 0 16px rgba(34,211,238,1))
    drop-shadow(0 0 34px rgba(34,211,238,.55));
}
@media(max-width:420px){
  .brand-logo-right{
    width:60px;
    height:60px;
  }
}

@media(max-width:420px){
  .login-brand{
    grid-template-columns: 50px 1fr 50px;
  }
}
.setpass-card {
  width: 420px;
  max-width: 90%;
  padding: 32px;
  border-radius: 20px;
  background: rgba(15, 23, 42, 0.85);
  backdrop-filter: blur(12px);
  box-shadow: 0 20px 50px rgba(0,0,0,0.35);
  text-align: center;
}
.setpass-card h2 {
  color: #e5e7eb;
  margin-bottom: 6px;
  font-size: 22px;
}
.setpass-sub {
  font-size: 13px;
  color: #94a3b8;
  margin-bottom: 22px;
}
.setpass-card input {
  width: 100%;
  padding: 14px 16px;
  margin-bottom: 14px;
  border-radius: 12px;
  border: none;
  outline: none;
  font-size: 14px;
}
.setpass-card button {
  width: 100%;
  padding: 14px;
  border-radius: 14px;
  border: none;
  font-size: 15px;
  font-weight: 600;
  color: white;
  cursor: pointer;
  background: linear-gradient(135deg, #22c55e, #06b6d4);
  transition: 
    transform 0.15s ease,
    box-shadow 0.15s ease;
}
.setpass-card button:hover {
  transform: translateY(-1px);
  box-shadow: 0 8px 20px rgba(34,197,94,0.35);
}
.setpass-card button:active {
  transform: scale(0.97);
}

 #app,
  #dashboard,
  nav,
  .container {
    display: none !important;
  }

</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="center">
  <div class="box">
    <div class="login-brand">

  <img src="favicon.png" class="brand-logo">

  <div class="brand-text">
    <div class="brand-title">AI & DATA SCIENCE</div>
    <div class="brand-sub">ADS 250</div>
  </div>
  <img src="gublogo.png" class="brand-logo brand-logo-right">
</div>
    <h2>üîê Login Portal</h2>
    <input id="loginId" placeholder="Student ID">
    <input id="loginOtp" placeholder="Passcode" type="password">
    <button onclick="doLogin()">Access Portal</button>
    <p onclick="showRegister()" style="cursor:pointer;color:#38bdf8">Register</p>
    <div class="error" id="loginError"></div>
  </div>
</div>

<!-- REGISTER -->
<div id="register" class="center">
  <div class="box">
    <h2>üìù Registration Portal</h2>
    <input id="regName" placeholder="Full Name">
    <input id="regId" type="number" placeholder="Student ID">
    <input id="regEmail" type="email" placeholder="Email">

    <button onclick="doRegister()">Register</button>
    <p onclick="showLogin()" style="cursor:pointer;color:#38bdf8">Back to Login</p>
    <div id="regResult"></div>
  </div>
</div>

<!-- SET PASSWORD -->
<div id="setPassword" class="center hidden">
  <div class="setpass-card">
    <h2>üîê Set New Password</h2>
    <p class="setpass-sub">
      This is your first login. Please choose a new password.
    </p>
    <form onsubmit="setNewPassword(event)">
      <input
        id="newPass"
        type="password"
        placeholder="New password"
        required
      >
      <input
        id="confirmPass"
        type="password"
        placeholder="Confirm password"
        required
      >
      <button type="submit">
        Save & Continue
      </button>
    </form>
  </div>
</div>


<!-- APP -->
<div id="app" class="hidden">
  <nav>
  <div class="logo">Artificial Intelligence and Data Science</div>
  <ul>
    <li onclick="showDashboard()">Home</li>
    <li onclick="showProfile()">Profile</li>
    <li onclick="showSpecialProgram()">Special Program</li>
    <li onclick="showAdmin()">Admin</li>
    <li onclick="logout()">Logout</li>
  </ul>
</nav>

<!-- DASHBOARD -->
<div id="dashboard" class="container fade hidden">
  <div id="semesterList">
    <div class="hero">
  <h1 id="welcomeText">Welcome back üëã</h1>
    <p>Your gateway to academic resources and course management.</p>
</div>
    <div class="grid">
      <div class="card">
        <h2>Spring Semester 2026</h2>
        <button onclick="openSemester()">View Details</button>
      </div>
    </div>
  </div>

  <div id="semester" class="hidden fade">
    <button onclick="goBack()" style="
      background:#7c3aed;color:white;border:none;
      padding:10px 20px;border-radius:10px;cursor:pointer;margin-bottom:25px;">
      ‚Üê Back to Semesters
    </button>

    <h2 style="color:#22d3ee;margin-bottom:30px">Spring Semester 2026</h2>

    <div class="grid">
      <div class="card"><h2>Data Science</h2>
        <button>View Details</button></div>
      <div class="card"><h2>Physics</h2>
        <button>View Details</button></div>
      <div class="card"><h2>Linear Algebra</h2>
        <button>View Details</button></div>
      <div class="card"><h2>Professional English</h2>
        <button>View Details</button></div>
      <div class="card"><h2>Physics Lab</h2>
        <button>View Details</button></div>
      <div class="card"><h2>Professional Life Skill Development</h2>
        <button>View Details</button></div>
    </div>
  </div>

  <!-- ===== ADD START: Course level ===== -->
  <div id="courseView" class="hidden fade">
    <button onclick="backToSemester()" style="background:#7c3aed;color:white;border:none;padding:10px 20px;border-radius:10px;cursor:pointer;margin-bottom:25px;">
      ‚Üê Back to Courses
    </button>
    <h2 id="courseTitle"></h2>
    <div class="option-grid">
      <div class="option-card" onclick="openExam('Mid-Term')">
        <h3>Mid-Term</h3>
        <button>View Details</button></div>
      <div class="option-card" onclick="openExam('Final')"><h3>Final</h3>
        <button>View Details</button></div>
    </div>
  </div>

  <!-- ===== ADD START: Exam level ===== -->
  <div id="examView" class="hidden fade">
    <button onclick="backToCourse()" style="background:#7c3aed;color:white;border:none;padding:10px 20px;border-radius:10px;cursor:pointer;margin-bottom:25px;">
      ‚Üê Back
    </button>
    <h2 id="examTitle"></h2>
    <div class="option-grid">
      <div class="option-card" onclick="openDrive('materials')"><h3>üìÅ Class Materials</h3></div>
      <div class="option-card" onclick="openDrive('resources')"><h3>üìö Resources</h3></div>
      <div class="option-card" onclick="openDrive('ct')"><h3>‚ùì CT Questions</h3></div>
    </div>
  </div>


</div>

<!-- SPECIAL PROGRAM -->
<div id="specialProgram" class="container hidden fade">
  <button onclick="backToDashboard()" style="
    background:#7c3aed;
    color:white;
    border:none;
    padding:10px 20px;
    border-radius:10px;
    cursor:pointer;
    margin-bottom:25px;">
    ‚Üê Back
  </button>
  <h2 style="color:#22d3ee;margin-bottom:30px">
    Special Program
  </h2>
  <div class="grid">
    <div class="card" onclick="openSpecialCourse('Computer Programming')">
      <h2>Computer Programming</h2>
      <button>View Details</button>
    </div>
    <div class="card" onclick="openSpecialCourse('Discrete Mathematics')">
      <h2>Discrete Mathematics</h2>
      <button>View Details</button>
    </div>
  </div>
</div>
<!-- SPECIAL PROGRAM COURSE VIEW -->
<div id="specialCourseView" class="container hidden fade">
  <button onclick="backToSpecialProgram()" style="
    background:#7c3aed;
    color:white;
    border:none;
    padding:10px 20px;
    border-radius:10px;
    cursor:pointer;
    margin-bottom:25px;">
    ‚Üê Back
  </button>
  <h2 id="specialCourseTitle" style="color:#22d3ee;margin-bottom:30px">
    Computer Programming
  </h2>
  <div class="option-grid" id="specialOptions">
  </div>
</div>

<!-- PROFILE -->
<div id="profile" class="container hidden fade">
  <div class="card">
    <h2>üë§ Profile</h2>
    <div id="profileData"></div>
  </div>
</div>

<!-- ADMIN -->
<div id="admin" class="container hidden fade">
  <div class="card">

    <h2>üîë Admin Panel</h2>

    <!-- ADMIN UNLOCK -->
    <div id="adminUnlock">
      <input id="adminMasterLogin" placeholder="Enter Master Password" type="password">
      <button onclick="unlockAdmin()">Unlock Admin Panel</button>
    </div>

    <!-- ADMIN TOOLS -->
    <div id="adminTools" class="hidden">
      <hr style="margin:20px 0;opacity:.2">
      <h3>Find User</h3>
      <input id="searchStudentId" placeholder="Student ID">
      <button onclick="findUser()">Search</button>
      <div id="foundUser" style="margin-top:15px;"></div>
      <h3>Pending Registrations</h3>
      <div id="pendingList"></div>
    </div>
    <p id="adminResult"></p>
  </div>
</div>

</div>
<footer class="site-footer hidden" id="simpleFooter"> ¬© 2026 ADS 250 | All rights reserved </footer>
<script>
const API = "https://ads-auth.sifatraj280.workers.dev";
const SESSION_DURATION = 30 * 60 * 1000;

/* ---------- NAV ---------- */
function hideAll(){
  ["login","register","setPassword","app","dashboard","specialProgram","specialCourseView","profile","admin"]
.forEach(id => {
  const el = document.getElementById(id);
  if(el) el.style.display = "none";
});
}
function showLogin(){ hideAll(); login.style.display="flex"; }
function showRegister(){ hideAll(); register.style.display="flex"; }
function showDashboard(){ hideAll(); app.style.display="block"; dashboard.style.display="block"; updateFooter("All rights reserved"); updateWelcomeName(); }
function showAdmin(){ hideAll(); app.style.display="block"; admin.style.display="block";updateFooter("Admin"); }

/* ---------- PROFILE ---------- */
function showProfile(){
  hideAll();
  app.style.display="block";
  profile.style.display="block";
  updateFooter("Profile");

  const session = JSON.parse(localStorage.getItem("auth_session") || "{}");
  const user = session.user || {};

  profileData.innerHTML = `
<div class="profile-card">
  <div class="avatar">${user.name?.[0] || "U"}</div>
  <h3>${user.name}</h3>
  <p>Email: ${user.email}</p>

  <div class="meta">
    <div><span>Student ID: ${user.studentId}</span></div>
  </div>
</div>
`;

}

/* ---------- SEMESTER ---------- */
function openSemester(){
  semesterList.classList.add("hidden");
  semester.classList.remove("hidden");
  updateFooter("Spring Semester 2026");
}
function goBack(){
  semester.classList.add("hidden");
  semesterList.classList.remove("hidden");
  updateFooter("All rights reserved");
}

/* ---------- REGISTER ---------- */
async function doRegister(){
  const name = regName.value.trim();
  const studentId = regId.value.trim();
  const email = regEmail.value.trim();
  // empty check
  if (!name || !studentId || !email) {
    regResult.innerText = "All fields are required";
    return;
  }
  // Student ID must be integer
  if (!/^\d+$/.test(studentId)) {
    regResult.innerText = "Student ID must be a valid number";
    return;
  }
  // Email validation
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailRegex.test(email)) {
    regResult.innerText = "Please enter a valid email address";
    return;
  }
  const res = await fetch(API + "/register", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      name,
      studentId,
      email
    })
  });
  const data = await res.json();
  if (!res.ok) {
    regResult.innerText = data.error || "Registration failed";
    return;
  }
  regResult.innerHTML = `
  <div style="
    margin-top:15px;
    padding:14px;
    border-radius:12px;
    background:#022c22;
    color:#22c55e;
    text-align:center;
  ">
    <p><b>Registration Successful</b></p>
    <p>Your Temporary Password</p>
    <h2 style="letter-spacing:2px">${data.tempPassword}</h2>
    <small>
      ‚ö†Ô∏è This password will work only after admin approval.<br>
      Please save it carefully.
    </small>
  </div>
`;
}

/* ---------- LOGIN ---------- */
async function doLogin(){
  const studentId = loginId.value.trim();
  const otp = loginOtp.value.trim();
  if(!studentId || !otp){
    loginError.innerText="Student ID and Passcode required";
    return;
  }

  const res = await fetch(API+"/login",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({studentId,password: otp})

  });

  const data = await res.json();
  if(!res.ok){
    loginError.innerText=data.error;
    return;
  }

  const profile = {
  name: data.name,
  studentId,
  email: data.email
};

  localStorage.setItem("auth_session", JSON.stringify({
  user: profile,
  loginTime: Date.now()
}));

  if (data.mustChangePassword) {
  hideAll();
  setPassword.style.display = "flex";
} else {
  showDashboard();
}
}

/* ---------- LOGOUT ---------- */
function logout(){
  localStorage.removeItem("auth_session");
  location.reload();
}

/* ===== ADD START: 4-level logic (NO existing change) ===== */
let currentCourse="", currentExam="";

const driveLinks={
  "Data Science":{ "Mid-Term":{materials:"https://drive.google.com/drive/folders/1Xp9ExGdaMFP-tEDOcXe_nMFQNx-qf9ff",resources:"https://drive.google.com/drive/folders/1me-kPCjlg2lkYhMt8nIo1Sb_9-V8GFgt",ct:"https://drive.google.com/XXXX"},
                  "Final":{materials:"https://drive.google.com/drive/folders/1g9ZWYrxDFp6cN9Tl_oAjFmdHbo0i9yGn",resources:"https://drive.google.com/drive/folders/1fNsP-UVGRA-jAo0Iq0wKjpwI3q9qaNz0",ct:"https://drive.google.com/XXXX"}},
  "Physics":{ "Mid-Term":{materials:"https://drive.google.com/drive/folders/1mWdjn-bPRfhfNVMLn99AE-7iZlPYXR8J",resources:"https://drive.google.com/drive/folders/1EHVW1fpej1KGaZpPdOQgdIHxKcgM4b5D",ct:"https://drive.google.com/XXXX"},
              "Final":{materials:"https://drive.google.com/drive/folders/1en4CruG9nBhXwK9MltiY82j_GMntye2L",resources:"https://drive.google.com/drive/folders/1_qGAkiH5Vf_U7GZcO2JyJFrkXVaXiyGO",ct:"https://drive.google.com/XXXX"}},
  "Linear Algebra":{ "Mid-Term":{materials:"https://drive.google.com/drive/folders/1KlMnxFWVkcIhd66BUvlohIOc9b1N953Q",resources:"https://drive.google.com/drive/folders/1G6T40uJsXDQA7Ermli5ThOAIvrZgle-g",ct:"https://drive.google.com/XXXX"},
                     "Final":{materials:"https://drive.google.com/drive/folders/1tbdu7TPKU0w03GbssICQamYrXPIGVhzu",resources:"https://drive.google.com/drive/folders/1j4tChwBkQd6p3UGiT1lQJbmUfO4YsACm",ct:"https://drive.google.com/XXXX"}},
  "Professional English":{ "Mid-Term":{materials:"https://drive.google.com/drive/folders/1OMMcheIQK8A2BB7KzX9QqNnjAjKrc8OM",resources:"https://drive.google.com/drive/folders/16qp3S_Sx-axHmDkvUoGgME4NORZqQw81",ct:"https://drive.google.com/XXXX"},
                            "Final":{materials:"https://drive.google.com/drive/folders/16pan3rzXkFE1KQ-6qNviaD4vryvbIxZX",resources:"https://drive.google.com/drive/folders/1VTYy4SxTPG8FvHCgWIPbzy4SQKjkHNDu",ct:"https://drive.google.com/XXXX"}},
  "Physics Lab":{ "Mid-Term":{materials:"https://drive.google.com/XXXX",resources:"https://drive.google.com/XXXX",ct:"https://drive.google.com/XXXX"},
                  "Final":{materials:"https://drive.google.com/XXXX",resources:"https://drive.google.com/XXXX",ct:"https://drive.google.com/XXXX"}},
  "Professional Life Skill Development":{ "Mid-Term":{materials:"https://drive.google.com/drive/folders/1A8NQ2uzFXIplFlfdqhyZILat6IqcuY5P",resources:"https://drive.google.com/drive/folders/1RZgT4L_K-eBdDkDTCFsWXM2KZMHdkDEc",ct:"https://drive.google.com/XXXX"},
                                          "Final":{materials:"https://drive.google.com/drive/folders/1ncRDAClQSUpt-XKxxyKCJDLo5OTRwPDS",resources:"https://drive.google.com/drive/folders/15vVAgmELPG78JoZXSYw8M9uWFec4khsk",ct:"https://drive.google.com/XXXX"}}
};

document.querySelectorAll("#semester .grid .card").forEach(card=>{
  card.addEventListener("click",()=>{
    currentCourse=card.querySelector("h2").innerText.trim();
    semester.classList.add("hidden");
    courseView.classList.remove("hidden");
    courseTitle.innerText=currentCourse;
    updateFooter(currentCourse);
  });
});

function openExam(e){
  currentExam=e;
  courseView.classList.add("hidden");
  examView.classList.remove("hidden");
  examTitle.innerText=e;
  updateFooter(currentCourse + " / " + e);
}
function backToCourse(){
  examView.classList.add("hidden");
  courseView.classList.remove("hidden");
  updateFooter(currentCourse);
}
function backToSemester(){
  courseView.classList.add("hidden");
  semester.classList.remove("hidden");
  updateFooter("Spring Semester 2026");
}
function openDrive(t){
  window.open(driveLinks[currentCourse][currentExam][t],"_blank");
}

function updateFooter(text){
  console.log("FOOTER UPDATE:", text);

  const footer = document.getElementById("simpleFooter"); // üî• FIX
  if(footer){
    footer.innerText = "¬© 2026 ADS 250 | " + text;
  }
}

let adminSessionPass = null;

function unlockAdmin(){
  const pass = adminMasterLogin.value.trim();

  if(!pass){
    adminResult.innerText = "Enter master password";
    return;
  }

  // save admin password for session
  adminSessionPass = pass;

  adminUnlock.classList.add("hidden");
  adminTools.classList.remove("hidden");

  adminResult.innerText = "Admin panel unlocked";

  // ‚úÖ THIS WAS MISSING
  loadPendingUsers();
}

/* ===== ENTER KEY SUPPORT ===== */

// login enter
if (typeof loginOtp !== "undefined") {
  loginOtp.addEventListener("keydown", function(e){
    if(e.key === "Enter"){
      doLogin();
    }
  });
}

// admin unlock enter
if (typeof adminMasterLogin !== "undefined") {
  adminMasterLogin.addEventListener("keydown", function(e){
    if(e.key === "Enter"){
      unlockAdmin();
    }
  });
}

function updateWelcomeName(){
  const session = JSON.parse(localStorage.getItem("auth_session") || "{}");
  const name = session?.user?.name || "Student";

  const el = document.getElementById("welcomeText");
  if(el){
    el.innerText = "Welcome back, " + name + " üëã";
  }
}
function showSpecialProgram(){
  hideAll();
  app.style.display = "block";
  specialProgram.style.display = "block";
  updateFooter("Special Program");
}
function openSpecialCourse(courseName){
  hideAll();
  app.style.display = "block";
  specialCourseView.style.display = "block";
  specialCourseTitle.innerText = courseName;
  updateFooter(courseName);
}
function backToSpecialProgram(){
  hideAll();
  app.style.display = "block";
  specialProgram.style.display = "block";
  updateFooter("Special Program");
}
const specialCourses = {
  "Computer Programming": [
    { key: "materials", label: "üìÅ Class Materials" },
    { key: "resources", label: "üìö Resources" },
    { key: "recorded", label: "üé• Recorded Class" },
    { key: "lab", label: "üî¨ Computer Programming Lab" }
  ],
  "Discrete Mathematics": [
    { key: "materials", label: "üìÅ Class Materials" },
    { key: "resources", label: "üìö Resources" }
  ]
};

const specialDriveLinks = {
  "Computer Programming": {
    materials: "https://drive.google.com/drive/folders/1tsXIhNLZrT3ByPgl288j7D2AQt0jeYZn",
    resources: "https://drive.google.com/drive/folders/1SEXXEilvj54f4Iffo1lnKcz_7X7fcaQ4",
    recorded: "https://drive.google.com/drive/folders/17ge6bu2pd7B0O55-mCBOxcQeuRHwECpc",
    lab: "https://drive.google.com/drive/folders/1sZ28CQwxTJ48blQbiDnzxMlVSiPXDMzv"
  },
  "Discrete Mathematics": {
    materials: "https://drive.google.com/drive/folders/1BwSU5hLRsorJwbNX0wDPvONgldr8gzjN",
    resources: "https://drive.google.com/drive/folders/1Ul-3QmS81pcqxDSh8keAnqrWPYkTKysc"
  }
};

function openSpecialCourse(courseName){
  hideAll();
  app.style.display = "block";
  specialCourseView.style.display = "block";
  specialCourseTitle.innerText = courseName;
  updateFooter(courseName);

  const box = document.getElementById("specialOptions");
  box.innerHTML = "";

  specialCourses[courseName].forEach(item => {
    const div = document.createElement("div");
    div.className = "option-card";
    div.innerHTML = `<h3>${item.label}</h3>`;
    div.onclick = () => {
      window.open(
        specialDriveLinks[courseName][item.key],
        "_blank"
      );
    };
    box.appendChild(div);
  });
}
function backToDashboard(){
  document.getElementById("specialProgram").style.display = "none";
  showDashboard();
}
// ===== STEP 3: ADMIN PENDING + APPROVE =====
async function loadPendingUsers(){
  const res = await fetch(API + "/admin-pending", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      masterPassword: adminSessionPass
    })
  });
  const data = await res.json();
  const box = document.getElementById("pendingList");
  box.innerHTML = "";
  if (!data.pending || data.pending.length === 0) {
    box.innerHTML = "<p>No pending requests</p>";
    return;
  }
  data.pending.forEach(user => {
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <p><b>${user.name}</b></p>
      <p>ID: ${user.studentId}</p>
      <p>${user.email}</p>
      <button onclick="approveUser('${user.studentId}')">
        Approve
      </button>
      <button onclick="rejectUser('${user.studentId}')" style="background:#dc2626;">
        Reject
      </button>
    `;
    box.appendChild(div);
  });
}

async function setNewPassword(e){
  e.preventDefault();
  const p1 = newPass.value.trim();
  const p2 = confirmPass.value.trim();

  if(p1 !== p2){
    alert("Passwords do not match");
    return;
  }
  const session = JSON.parse(localStorage.getItem("auth_session"));
  if(!session){
  alert("Session expired");
  return;
  }
  const res = await fetch(API + "/set-password", {
    method: "POST",
    headers: { "Content-Type":"application/json" },
    body: JSON.stringify({
      studentId: session.user.studentId,
      newPassword: p1
    })
  });
  if(res.ok){
    localStorage.removeItem("auth_session");
    alert("Password updated. Please login again.");
    location.reload();
  } else {
    alert("Failed to set password");
  }
}
async function approveUser(studentId){
  const res = await fetch(API + "/admin-approve", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      studentId,
      masterPassword: adminSessionPass
    })
  });
  const data = await res.json();
  alert(data.message || "Approved");
  loadPendingUsers();
}
async function rejectUser(studentId){
  if(!confirm("Reject this user?")) return;
  const res = await fetch(API + "/admin-reject", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      studentId,
      masterPassword: adminSessionPass
    })
  });
  const data = await res.json();
  alert(data.message || "Rejected");
  loadPendingUsers();
}
async function findUser(){
  const studentId = searchStudentId.value.trim();
  if(!studentId){
    foundUser.innerText = "Enter Student ID";
    return;
  }
  const res = await fetch(API + "/admin-find-user", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      studentId,
      masterPassword: adminSessionPass
    })
  });
  const data = await res.json();
  if(!res.ok){
    foundUser.innerText = data.error || "User not found";
    return;
  }
  foundUser.innerHTML = `
    <div class="card">
      <p><b>${data.name}</b></p>
      <p>Email: ${data.email}</p>
      <p style="color:#22c55e">
        Password: <b>${data.password}</b>
      </p>
      <small>mustChangePassword: ${data.mustChangePassword}</small>
    </div>
  `;
}

window.onload = () => {
  const session = JSON.parse(localStorage.getItem("auth_session") || "{}");
  // session valid (30 minutes)
  if (
    session.loginTime &&
    Date.now() - session.loginTime < SESSION_DURATION
  ) {
    hideAll();
    app.style.display = "block";
    dashboard.style.display = "block";
    updateWelcomeName();
    updateFooter("All rights reserved");
  } else {
    // no session / expired
    localStorage.removeItem("auth_session");
    hideAll();
    login.style.display = "flex";
  }
  document.getElementById("simpleFooter").style.display = "block";
};


/* ===== ADD END ===== */
</script>
</body>
</html>
