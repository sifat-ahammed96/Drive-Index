<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Artificial Intelligence and Data Science</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --bg-dark:#0b1220;
  --bg-card:#2a3445;
  --green:#00c853;
  --text:#e5e7eb;
}
body {
  margin:0;
  font-family:"Segoe UI",Arial,sans-serif;
  background:linear-gradient(180deg,#0b1220,#111827);
  color:var(--text);
}
.hidden{display:none}
.center{height:100vh;display:flex;justify-content:center;align-items:center}
.box{background:#020617;padding:30px;border-radius:15px;width:320px;text-align:center}
input,button{
  width:100%;padding:12px;margin-bottom:12px;
  border:none;border-radius:8px
}
button{background:var(--green);color:white;cursor:pointer}
.error{color:#f87171;font-size:14px}

nav{
  background:var(--green);
  padding:15px 30px;
  display:flex;justify-content:space-between;align-items:center
}
.logo{font-size:22px;font-weight:bold;color:white}
nav ul{list-style:none;display:flex;gap:25px;margin:0;padding:0}
nav li{cursor:pointer;color:white}

.container{max-width:1100px;margin:auto;padding:40px 20px;text-align:center}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:25px}
.card{background:var(--bg-card);padding:30px;border-radius:20px}
.card h2{color:#38bdf8}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="center">
  <div class="box">
    <h2>üîê Login</h2>
    <input id="loginId" placeholder="Student ID">
    <input id="loginOtp" placeholder="Passcode" type="password">
    <button onclick="doLogin()">Log in</button>
    <p onclick="showRegister()" style="cursor:pointer;color:#38bdf8">Register</p>
    <div class="error" id="loginError"></div>
  </div>
</div>

<!-- REGISTER -->
<div id="register" class="center hidden">
  <div class="box">
    <h2>üìù Register</h2>
    <input id="regName" placeholder="Full Name">
    <input id="regId" placeholder="Student ID">
    <input id="regEmail" placeholder="Email">
    <button onclick="doRegister()">Register</button>
    <p onclick="showLogin()" style="cursor:pointer;color:#38bdf8">Back to Login</p>
    <div id="regResult"></div>
  </div>
</div>

<!-- APP -->
<div id="app" class="hidden">

<nav>
  <div class="logo">Artificial Intelligence and Data Science</div>
  <ul>
    <li onclick="showDashboard()">Home</li>
    <li onclick="showProfile()">Profile</li>
    <li onclick="showAdmin()">Admin</li>
    <li onclick="logout()">Logout</li>
  </ul>
</nav>

<!-- DASHBOARD -->
<div id="dashboard" class="container">

  <div id="semesterList">
    <div class="grid">
      <div class="card">
        <h2>Spring Semester 2026</h2>
        <button onclick="openSemester()">View Details</button>
      </div>
    </div>
  </div>

  <div id="semester" class="hidden">
    <button onclick="goBack()" style="
      background:#7c3aed;color:white;border:none;
      padding:10px 20px;border-radius:10px;cursor:pointer;margin-bottom:25px;">
      ‚Üê Back to Semesters
    </button>

    <h2 style="color:#22d3ee;margin-bottom:30px">Spring Semester 2026</h2>

    <div class="grid">
      <div class="card"><h2>Data Science</h2></div>
      <div class="card"><h2>Physics</h2></div>
      <div class="card"><h2>Linear Algebra</h2></div>
      <div class="card"><h2>Professional English</h2></div>
      <div class="card"><h2>Physics Lab</h2></div>
      <div class="card"><h2>Professional Life Skill Development</h2></div>
    </div>
  </div>
</div>

<!-- PROFILE -->
<div id="profile" class="container hidden">
  <div class="card">
    <h2>üë§ Profile</h2>
    <div id="profileData"></div>
  </div>
</div>

<!-- ADMIN -->
<div id="admin" class="container hidden">
  <div class="card">
    <h2>üîë Admin Reset</h2>
    <input id="adminPass" placeholder="Master Password">
    <input id="adminId" placeholder="Student ID">
    <button onclick="adminReset()">Reset OTP</button>
    <p id="adminResult"></p>
  </div>
</div>

</div>

<script>
const API = "https://ads-auth.sifatraj280.workers.dev";
const SESSION_DURATION = 30 * 60 * 1000;

/* ---------- NAV ---------- */
function hideAll(){
  ["login","register","dashboard","profile","admin","app"]
  .forEach(id=>document.getElementById(id).style.display="none");
}
function showLogin(){ hideAll(); login.style.display="flex"; }
function showRegister(){ hideAll(); register.style.display="flex"; }
function showDashboard(){ hideAll(); app.style.display="block"; dashboard.style.display="block"; }
function showAdmin(){ hideAll(); app.style.display="block"; admin.style.display="block"; }

/* ---------- PROFILE ---------- */
function showProfile(){
  hideAll();
  app.style.display="block";
  profile.style.display="block";

  const session = JSON.parse(localStorage.getItem("auth_session") || "{}");
  const user = session.user || {};

  profileData.innerHTML = `
    <strong style="font-size:22px">${user.name || "Unknown User"}</strong><br><br>
    Student ID: ${user.studentId || "-"}<br>
    Email: ${user.email || "-"}<br><br>
    <strong>Next Login Passcode:</strong> ${session.newOtp || "‚Äî"}
  `;
}

/* ---------- SEMESTER ---------- */
function openSemester(){
  semesterList.classList.add("hidden");
  semester.classList.remove("hidden");
}
function goBack(){
  semester.classList.add("hidden");
  semesterList.classList.remove("hidden");
}

/* ---------- REGISTER ---------- */
async function doRegister(){
  const name = regName.value.trim();
  const studentId = regId.value.trim();
  const email = regEmail.value.trim();

  const res = await fetch(API+"/register",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ name, studentId, email })
  });

  const data = await res.json();

  if(data.otp){
    localStorage.setItem("profile_"+studentId, JSON.stringify({ name, studentId, email }));
    regResult.innerText = "Your OTP: "+data.otp;
  }
}

/* ---------- LOGIN ---------- */
async function doLogin(){
  const studentId = loginId.value.trim();
  const otp = loginOtp.value.trim();
  if(!studentId || !otp){
    loginError.innerText="Student ID and Passcode required";
    return;
  }

  const res = await fetch(API+"/login",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ studentId, otp })
  });

  const data = await res.json();
  if(!res.ok){
    loginError.innerText=data.error;
    return;
  }

  const profile = JSON.parse(localStorage.getItem("profile_"+studentId) || "{}");

  localStorage.setItem("auth_session", JSON.stringify({
    user: profile,
    newOtp: data.newOtp,
    loginTime: Date.now()
  }));

  showDashboard();
}

/* ---------- AUTO LOGIN ---------- */
(function autoLogin(){
  const session = JSON.parse(localStorage.getItem("auth_session") || "{}");
  if(!session.loginTime) return;
  if(Date.now() - session.loginTime > SESSION_DURATION){
    localStorage.removeItem("auth_session");
    return;
  }
  showDashboard();
})();

/* ---------- LOGOUT ---------- */
function logout(){
  localStorage.removeItem("auth_session");
  location.reload();
}
</script>

</body>
</html>
